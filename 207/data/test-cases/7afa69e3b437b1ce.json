{"uid":"7afa69e3b437b1ce","name":"Получение сиблингов документа (kind=Member)","fullName":"tests.test_backend.document.test_get_siblings#test_get_document_siblings","historyId":"a0be83c6225d199ec0cbf2b352a8339d","time":{"start":1750852379693,"stop":1750852381361,"duration":1668},"status":"failed","statusMessage":"AssertionError: assert {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} is None\n +  where {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} = <built-in method get of dict object at 0x7feecc734080>('prevSibling')\n +    where <built-in method get of dict object at 0x7feecc734080> = {'parents': [], 'prevSibling': {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'tree': [{'document': {'_id': '685be31ba2b8f0d475361167', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ba2b8f0d475361167', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685be31ca2b8f0d47536117a', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536117a', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685be31ca2b8f0d47536118e', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536118e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685be31ca2b8f0d4753611a3', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d4753611a3', 'lft': 5, 'rgt': 6}]}.get","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7feecc9331d0>\nrequest = <FixtureRequest for <Function test_get_document_siblings[member]>>\ntemp_space = '685be2c9a2b8f0d47535fb1f', kind = 'Member'\nfixture_name = 'temp_member'\n\n    @pytest.mark.parametrize(\n        'kind, fixture_name',\n        [\n            ('Project', 'temp_project'),\n            ('Space', 'temp_space'),\n            ('Member', 'temp_member'),\n        ],\n        ids=['project', 'space', 'member'],\n    )\n    def test_get_document_siblings(owner_client, request, temp_space, kind, fixture_name):\n        kind_id = request.getfixturevalue(fixture_name)\n        allure.dynamic.title(f'Получение сиблингов документа (kind={kind})')\n    \n        with allure.step('Создание родительского документа'):\n            resp = owner_client.post(\n                **create_document_endpoint(kind=kind, kind_id=kind_id, space_id=temp_space, title='Parent')\n            )\n            assert resp.status_code == 200\n            parent_id = resp.json()['payload']['document']['_id']\n    \n        with allure.step('Создание дочерних документов'):\n            titles = ['Child A', 'Child B', 'Child C']\n            indices = [0, 1, 2]\n            child_ids = []\n    \n            for title, index in zip(titles, indices):\n                resp = owner_client.post(\n                    **create_document_endpoint(\n                        kind=kind,\n                        kind_id=kind_id,\n                        space_id=temp_space,\n                        title=title,\n                        parent_document_id=parent_id,\n                        index=index,\n                    )\n                )\n                assert resp.status_code == 200\n                child_ids.append(resp.json()['payload']['document']['_id'])\n    \n        with allure.step('Запрос сиблингов для среднего дочернего документа'):\n            target_id = child_ids[1]\n            resp = owner_client.post(\n                **get_document_siblings_endpoint(document_id=target_id, space_id=temp_space)\n            )\n            assert resp.status_code == 200\n            payload = resp.json()['payload']\n    \n        with allure.step('Проверка корректности сиблингов'):\n            assert payload['prevSibling']['_id'] == child_ids[0]\n            assert payload['nextSibling']['_id'] == child_ids[2]\n            assert payload['parents'][0]['_id'] == parent_id\n            assert any(node['document']['_id'] == target_id for node in payload['tree'])\n    \n        with allure.step('Проверка структуры дерева'):\n            for node in payload['tree']:\n                assert 'document' in node, 'В узле дерева отсутствует поле document'\n    \n        with allure.step('Проверка наличия обязательных полей в document'):\n            required_fields = ['_id', 'title', 'kind', 'kindId']\n            for node in payload['tree']:\n                for field in required_fields:\n                    assert field in node['document'], f'В документе отсутствует поле {field}'\n    \n        with allure.step('Проверка сиблингов родительского документа — их не должно быть'):\n            resp = owner_client.post(\n                **get_document_siblings_endpoint(document_id=parent_id, space_id=temp_space)\n            )\n            assert resp.status_code == 200\n            payload = resp.json()['payload']\n>           assert payload.get('prevSibling') is None\nE           AssertionError: assert {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} is None\nE            +  where {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} = <built-in method get of dict object at 0x7feecc734080>('prevSibling')\nE            +    where <built-in method get of dict object at 0x7feecc734080> = {'parents': [], 'prevSibling': {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'tree': [{'document': {'_id': '685be31ba2b8f0d475361167', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ba2b8f0d475361167', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685be31ca2b8f0d47536117a', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536117a', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685be31ca2b8f0d47536118e', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536118e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685be31ca2b8f0d4753611a3', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d4753611a3', 'lft': 5, 'rgt': 6}]}.get\n\ntests/test_backend/document/test_get_siblings.py:81: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_verify_url","time":{"start":1750852296452,"stop":1750852296452,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"pytestconfig","time":{"start":1750852296452,"stop":1750852296452,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"owner_client","time":{"start":1750852296452,"stop":1750852297051,"duration":599},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"base_url","time":{"start":1750852296452,"stop":1750852296452,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"delete_output_dir","time":{"start":1750852296452,"stop":1750852296452,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"temp_space","time":{"start":1750852297051,"stop":1750852297753,"duration":702},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"temp_member","time":{"start":1750852322577,"stop":1750852322863,"duration":286},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} is None\n +  where {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} = <built-in method get of dict object at 0x7feecc734080>('prevSibling')\n +    where <built-in method get of dict object at 0x7feecc734080> = {'parents': [], 'prevSibling': {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'tree': [{'document': {'_id': '685be31ba2b8f0d475361167', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ba2b8f0d475361167', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685be31ca2b8f0d47536117a', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536117a', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685be31ca2b8f0d47536118e', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536118e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685be31ca2b8f0d4753611a3', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d4753611a3', 'lft': 5, 'rgt': 6}]}.get","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7feecc9331d0>\nrequest = <FixtureRequest for <Function test_get_document_siblings[member]>>\ntemp_space = '685be2c9a2b8f0d47535fb1f', kind = 'Member'\nfixture_name = 'temp_member'\n\n    @pytest.mark.parametrize(\n        'kind, fixture_name',\n        [\n            ('Project', 'temp_project'),\n            ('Space', 'temp_space'),\n            ('Member', 'temp_member'),\n        ],\n        ids=['project', 'space', 'member'],\n    )\n    def test_get_document_siblings(owner_client, request, temp_space, kind, fixture_name):\n        kind_id = request.getfixturevalue(fixture_name)\n        allure.dynamic.title(f'Получение сиблингов документа (kind={kind})')\n    \n        with allure.step('Создание родительского документа'):\n            resp = owner_client.post(\n                **create_document_endpoint(kind=kind, kind_id=kind_id, space_id=temp_space, title='Parent')\n            )\n            assert resp.status_code == 200\n            parent_id = resp.json()['payload']['document']['_id']\n    \n        with allure.step('Создание дочерних документов'):\n            titles = ['Child A', 'Child B', 'Child C']\n            indices = [0, 1, 2]\n            child_ids = []\n    \n            for title, index in zip(titles, indices):\n                resp = owner_client.post(\n                    **create_document_endpoint(\n                        kind=kind,\n                        kind_id=kind_id,\n                        space_id=temp_space,\n                        title=title,\n                        parent_document_id=parent_id,\n                        index=index,\n                    )\n                )\n                assert resp.status_code == 200\n                child_ids.append(resp.json()['payload']['document']['_id'])\n    \n        with allure.step('Запрос сиблингов для среднего дочернего документа'):\n            target_id = child_ids[1]\n            resp = owner_client.post(\n                **get_document_siblings_endpoint(document_id=target_id, space_id=temp_space)\n            )\n            assert resp.status_code == 200\n            payload = resp.json()['payload']\n    \n        with allure.step('Проверка корректности сиблингов'):\n            assert payload['prevSibling']['_id'] == child_ids[0]\n            assert payload['nextSibling']['_id'] == child_ids[2]\n            assert payload['parents'][0]['_id'] == parent_id\n            assert any(node['document']['_id'] == target_id for node in payload['tree'])\n    \n        with allure.step('Проверка структуры дерева'):\n            for node in payload['tree']:\n                assert 'document' in node, 'В узле дерева отсутствует поле document'\n    \n        with allure.step('Проверка наличия обязательных полей в document'):\n            required_fields = ['_id', 'title', 'kind', 'kindId']\n            for node in payload['tree']:\n                for field in required_fields:\n                    assert field in node['document'], f'В документе отсутствует поле {field}'\n    \n        with allure.step('Проверка сиблингов родительского документа — их не должно быть'):\n            resp = owner_client.post(\n                **get_document_siblings_endpoint(document_id=parent_id, space_id=temp_space)\n            )\n            assert resp.status_code == 200\n            payload = resp.json()['payload']\n>           assert payload.get('prevSibling') is None\nE           AssertionError: assert {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} is None\nE            +  where {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} = <built-in method get of dict object at 0x7feecc734080>('prevSibling')\nE            +    where <built-in method get of dict object at 0x7feecc734080> = {'parents': [], 'prevSibling': {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'tree': [{'document': {'_id': '685be31ba2b8f0d475361167', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ba2b8f0d475361167', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685be31ca2b8f0d47536117a', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536117a', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685be31ca2b8f0d47536118e', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536118e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685be31ca2b8f0d4753611a3', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d4753611a3', 'lft': 5, 'rgt': 6}]}.get\n\ntests/test_backend/document/test_get_siblings.py:81: AssertionError","steps":[{"name":"Создание родительского документа","time":{"start":1750852379693,"stop":1750852379961,"duration":268},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Создание дочерних документов","time":{"start":1750852379961,"stop":1750852380874,"duration":913},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Запрос сиблингов для среднего дочернего документа","time":{"start":1750852380874,"stop":1750852381122,"duration":248},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка корректности сиблингов","time":{"start":1750852381122,"stop":1750852381122,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка структуры дерева","time":{"start":1750852381122,"stop":1750852381122,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка наличия обязательных полей в document","time":{"start":1750852381122,"stop":1750852381122,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка сиблингов родительского документа — их не должно быть","time":{"start":1750852381122,"stop":1750852381361,"duration":239},"status":"failed","statusMessage":"AssertionError: assert {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} is None\n +  where {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...} = <built-in method get of dict object at 0x7feecc734080>('prevSibling')\n +    where <built-in method get of dict object at 0x7feecc734080> = {'parents': [], 'prevSibling': {'_id': '685be315a2b8f0d475360f64', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'tree': [{'document': {'_id': '685be31ba2b8f0d475361167', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ba2b8f0d475361167', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685be31ca2b8f0d47536117a', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536117a', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685be31ca2b8f0d47536118e', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d47536118e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685be31ca2b8f0d4753611a3', 'kind': 'Member', 'kindId': '685be2c9a2b8f0d47535fb21', 'map': [], ...}, 'id': '685be31ca2b8f0d4753611a3', 'lft': 5, 'rgt': 6}]}.get\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/document/test_get_siblings.py\", line 81, in test_get_document_siblings\n    assert payload.get('prevSibling') is None\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":7,"attachmentsCount":0,"hasContent":true},"afterStages":[{"name":"temp_member::0","time":{"start":1750852395459,"stop":1750852395459,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"temp_space::0","time":{"start":1750852395460,"stop":1750852396213,"duration":753},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"labels":[{"name":"tag","value":"backend"},{"name":"parentSuite","value":"tests.test_backend.document"},{"name":"suite","value":"test_get_siblings"},{"name":"host","value":"pkrvmxyh4eaekms"},{"name":"thread","value":"2618-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.document.test_get_siblings"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"fixture_name","value":"'temp_member'"},{"name":"kind","value":"'Member'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":1,"unknown":0,"total":2},"items":[{"uid":"bc3cbd363c756b0a","reportUrl":"https://vaizcom.github.io/autotests/206//#testresult/bc3cbd363c756b0a","status":"passed","time":{"start":1750773509212,"stop":1750773552446,"duration":43234}}]},"tags":["backend"]},"source":"7afa69e3b437b1ce.json","parameterValues":["'temp_member'","'Member'"]}