{"uid":"351f6134df908bbe","name":"Доступ к таскам спейса под ролью Member (HTTP 200)","fullName":"tests.test_backend.task_service.get_tasks.access_get_tasks.test_get_tasks_space_all#test_get_tasks_by_role_in_second_space","historyId":"5b5275fc47756df7940aa6eca83f1c59","time":{"start":1763996535793,"stop":1763996568354,"duration":32561},"description":"\n    Проверка доступа ко всем таскам в спейсе для всех ролей:\n    - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\n    TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n    (сейчас указан спейс в котором нет архивных тасок)\n    ","descriptionHtml":"<pre><code>Проверка доступа ко всем таскам в спейсе для всех ролей:\n- роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\nTODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n(сейчас указан спейс в котором нет архивных тасок)\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452","statusTrace":"request = <FixtureRequest for <Function test_get_tasks_by_role_in_second_space[member]>>\nclient_fixture = 'member_client', expected_status = 200\nsecond_space = '691adf9e4bfde6405d9feb3a'\nsecond_project = '691adf9f4bfde6405d9feb4a'\nmain_project = '686672af85fb8d104544e798'\n\n    @allure.title(\"GetTasks: Проверка доступа к задачам спейса для всех ролей (без фильтраций)\")\n    @pytest.mark.parametrize(\n        'client_fixture, expected_status',\n        [\n            ('owner_client', 200),\n            ('manager_client', 200),\n            ('member_client', 200),\n            ('guest_client', 200)\n        ],\n        ids=['owner', 'manager', 'member', 'guest'],\n    )\n    def test_get_tasks_by_role_in_second_space(request, client_fixture, expected_status, second_space, second_project, main_project):\n        \"\"\"\n        Проверка доступа ко всем таскам в спейсе для всех ролей:\n        - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n    \n        TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n        (сейчас указан спейс в котором нет архивных тасок)\n        \"\"\"\n        client = request.getfixturevalue(client_fixture)\n        role_name = client_fixture.replace('_client', '').capitalize()\n        allure.dynamic.title(f\"Доступ к таскам спейса под ролью {role_name} (HTTP {expected_status})\")\n    \n        with allure.step(f\"{client_fixture}: вызвать GetTasks без фильтров\"):\n            resp = client.post(**get_tasks_endpoint(space_id=second_space))\n    \n        with allure.step(f\"Проверить HTTP {expected_status}\"):\n            assert resp.status_code == expected_status\n    \n        with allure.step(\"Проверить payload\"):\n            payload = resp.json().get(\"payload\", {})\n            assert \"tasks\" in payload and isinstance(payload[\"tasks\"], list)\n            tasks = payload[\"tasks\"]\n    \n        if not tasks:\n            pytest.skip(\"Список задач пуст — нечего валидировать\")\n    \n        # Жёсткая проверка: каждая задача должна принадлежать только second_project\n        with allure.step(\"Проверить отсутствие задач из другого спейса)\"):\n            for task in tasks[:20]:\n                assert \"project\" in task, f\"У задачи {task.get('_id', 'unknown')} отсутствует поле project\"\n>               assert task.get(\"project\") == second_project, (\n                    f\"Задача {task.get('_id', 'unknown')} принадлежит другому проекту: {task.get('project')}, \"\n                    f\"ожидался {second_project}\"\n                    )\nE               AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nE               assert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\nE                 \nE                 - 691adf9f4bfde6405d9feb4a\nE                 + 63286261a466b6becd9d6452\n\ntests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py:49: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"description":"\n    Проверка доступа ко всем таскам в спейсе для всех ролей:\n    - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\n    TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n    (сейчас указан спейс в котором нет архивных тасок)\n    ","status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452","statusTrace":"request = <FixtureRequest for <Function test_get_tasks_by_role_in_second_space[member]>>\nclient_fixture = 'member_client', expected_status = 200\nsecond_space = '691adf9e4bfde6405d9feb3a'\nsecond_project = '691adf9f4bfde6405d9feb4a'\nmain_project = '686672af85fb8d104544e798'\n\n    @allure.title(\"GetTasks: Проверка доступа к задачам спейса для всех ролей (без фильтраций)\")\n    @pytest.mark.parametrize(\n        'client_fixture, expected_status',\n        [\n            ('owner_client', 200),\n            ('manager_client', 200),\n            ('member_client', 200),\n            ('guest_client', 200)\n        ],\n        ids=['owner', 'manager', 'member', 'guest'],\n    )\n    def test_get_tasks_by_role_in_second_space(request, client_fixture, expected_status, second_space, second_project, main_project):\n        \"\"\"\n        Проверка доступа ко всем таскам в спейсе для всех ролей:\n        - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n    \n        TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n        (сейчас указан спейс в котором нет архивных тасок)\n        \"\"\"\n        client = request.getfixturevalue(client_fixture)\n        role_name = client_fixture.replace('_client', '').capitalize()\n        allure.dynamic.title(f\"Доступ к таскам спейса под ролью {role_name} (HTTP {expected_status})\")\n    \n        with allure.step(f\"{client_fixture}: вызвать GetTasks без фильтров\"):\n            resp = client.post(**get_tasks_endpoint(space_id=second_space))\n    \n        with allure.step(f\"Проверить HTTP {expected_status}\"):\n            assert resp.status_code == expected_status\n    \n        with allure.step(\"Проверить payload\"):\n            payload = resp.json().get(\"payload\", {})\n            assert \"tasks\" in payload and isinstance(payload[\"tasks\"], list)\n            tasks = payload[\"tasks\"]\n    \n        if not tasks:\n            pytest.skip(\"Список задач пуст — нечего валидировать\")\n    \n        # Жёсткая проверка: каждая задача должна принадлежать только second_project\n        with allure.step(\"Проверить отсутствие задач из другого спейса)\"):\n            for task in tasks[:20]:\n                assert \"project\" in task, f\"У задачи {task.get('_id', 'unknown')} отсутствует поле project\"\n>               assert task.get(\"project\") == second_project, (\n                    f\"Задача {task.get('_id', 'unknown')} принадлежит другому проекту: {task.get('project')}, \"\n                    f\"ожидался {second_project}\"\n                    )\nE               AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nE               assert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\nE                 \nE                 - 691adf9f4bfde6405d9feb4a\nE                 + 63286261a466b6becd9d6452\n\ntests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py:49: AssertionError","steps":[{"name":"member_client: вызвать GetTasks без фильтров","time":{"start":1763996535793,"stop":1763996567790,"duration":31997},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить HTTP 200","time":{"start":1763996567790,"stop":1763996567790,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить payload","time":{"start":1763996567790,"stop":1763996568353,"duration":563},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить отсутствие задач из другого спейса)","time":{"start":1763996568353,"stop":1763996568353,"duration":0},"status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py\", line 49, in test_get_tasks_by_role_in_second_space\n    assert task.get(\"project\") == second_project, (\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":4,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"tag","value":"backend"},{"name":"parentSuite","value":"tests.test_backend.task_service.get_tasks.access_get_tasks"},{"name":"suite","value":"test_get_tasks_space_all"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"2653-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.task_service.get_tasks.access_get_tasks.test_get_tasks_space_all"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"client_fixture","value":"'member_client'"},{"name":"expected_status","value":"200"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":19,"unknown":0,"total":20},"items":[{"uid":"3fdec8bf8dbb8360","reportUrl":"https://vaizcom.github.io/autotests/470/#testresult/3fdec8bf8dbb8360","status":"passed","time":{"start":1763995227728,"stop":1763995228207,"duration":479}},{"uid":"31164b0faacaf746","reportUrl":"https://vaizcom.github.io/autotests/469/#testresult/31164b0faacaf746","status":"passed","time":{"start":1763993480776,"stop":1763993481024,"duration":248}},{"uid":"ea05d8b302306423","reportUrl":"https://vaizcom.github.io/autotests/468/#testresult/ea05d8b302306423","status":"passed","time":{"start":1763734845741,"stop":1763734845988,"duration":247}},{"uid":"5f59a70ae0218e2e","reportUrl":"https://vaizcom.github.io/autotests/467/#testresult/5f59a70ae0218e2e","status":"passed","time":{"start":1763733026370,"stop":1763733026616,"duration":246}},{"uid":"8f9e7ab318086323","reportUrl":"https://vaizcom.github.io/autotests/466/#testresult/8f9e7ab318086323","status":"passed","time":{"start":1763726679965,"stop":1763726680233,"duration":268}},{"uid":"c7cb9170a83ed400","reportUrl":"https://vaizcom.github.io/autotests/465/#testresult/c7cb9170a83ed400","status":"passed","time":{"start":1763720220291,"stop":1763720220480,"duration":189}},{"uid":"eee272f8e64d271a","reportUrl":"https://vaizcom.github.io/autotests/464/#testresult/eee272f8e64d271a","status":"passed","time":{"start":1763715530283,"stop":1763715530473,"duration":190}},{"uid":"24a7283282ebe400","reportUrl":"https://vaizcom.github.io/autotests/463/#testresult/24a7283282ebe400","status":"passed","time":{"start":1763714950508,"stop":1763714950764,"duration":256}},{"uid":"97421deb729e825","reportUrl":"https://vaizcom.github.io/autotests/462/#testresult/97421deb729e825","status":"passed","time":{"start":1763711384413,"stop":1763711384612,"duration":199}},{"uid":"c10b625e779831b0","reportUrl":"https://vaizcom.github.io/autotests/461/#testresult/c10b625e779831b0","status":"passed","time":{"start":1763710406683,"stop":1763710407250,"duration":567}},{"uid":"121757cbec2eeeff","reportUrl":"https://vaizcom.github.io/autotests/460/#testresult/121757cbec2eeeff","status":"passed","time":{"start":1763651933400,"stop":1763651933583,"duration":183}},{"uid":"f10a50ff42aaf4ee","reportUrl":"https://vaizcom.github.io/autotests/459/#testresult/f10a50ff42aaf4ee","status":"passed","time":{"start":1763650073126,"stop":1763650073459,"duration":333}},{"uid":"6c88e2175f09ef4e","reportUrl":"https://vaizcom.github.io/autotests/458/#testresult/6c88e2175f09ef4e","status":"passed","time":{"start":1763631446071,"stop":1763631446253,"duration":182}},{"uid":"7c2d25bd612f14e6","reportUrl":"https://vaizcom.github.io/autotests/457/#testresult/7c2d25bd612f14e6","status":"passed","time":{"start":1763628802983,"stop":1763628803281,"duration":298}},{"uid":"9dd93afeb85baf5d","reportUrl":"https://vaizcom.github.io/autotests/456/#testresult/9dd93afeb85baf5d","status":"passed","time":{"start":1763559940239,"stop":1763559940491,"duration":252}},{"uid":"6f5812f1c81d9b8f","reportUrl":"https://vaizcom.github.io/autotests/455/#testresult/6f5812f1c81d9b8f","status":"passed","time":{"start":1763542888217,"stop":1763542888646,"duration":429}},{"uid":"735a13e2c88536d8","reportUrl":"https://vaizcom.github.io/autotests/454/#testresult/735a13e2c88536d8","status":"passed","time":{"start":1763540615325,"stop":1763540615524,"duration":199}},{"uid":"96c0010e8ae272b1","reportUrl":"https://vaizcom.github.io/autotests/453/#testresult/96c0010e8ae272b1","status":"passed","time":{"start":1763478067897,"stop":1763478068136,"duration":239}},{"uid":"983cdd8d7f89624","reportUrl":"https://vaizcom.github.io/autotests/452/#testresult/983cdd8d7f89624","status":"passed","time":{"start":1763476249482,"stop":1763476249783,"duration":301}}]},"tags":["backend"]},"source":"351f6134df908bbe.json","parameterValues":["'member_client'","200"]}