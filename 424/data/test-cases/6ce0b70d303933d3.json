{"uid":"6ce0b70d303933d3","name":"Негативный сценарий: гостевой пользователь не может получить siblings (kind=Project)","fullName":"tests.test_backend.document.test_get_siblings#test_get_document_siblings_foreign_space","historyId":"89d91b5f384735452e4752fd57d3e2f5","time":{"start":1762520290833,"stop":1762520305138,"duration":14305},"status":"failed","statusMessage":"AssertionError: Ожидался 403, но получен 520\nassert 520 == 403\n +  where 520 = <Response [520]>.status_code","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f292e507e90>\nguest_client = <tests.core.client.APIClient object at 0x7f292e5bf390>\nrequest = <FixtureRequest for <Function test_get_document_siblings_foreign_space[project]>>\nkind = 'Project', kind_id_fixture = 'project_id_function'\nspace_id_function = '690dece24aa117e4bab2de1b'\n\n    @pytest.mark.parametrize(\n        'kind, kind_id_fixture',\n        [\n            ('Project', 'project_id_function'),\n            ('Space', 'space_id_function'),\n            ('Member', 'member_id_function'),\n        ],\n        ids=['project', 'space', 'member'],\n    )\n    def test_get_document_siblings_foreign_space(\n        owner_client, guest_client, request, kind, kind_id_fixture, space_id_function\n    ):\n        allure.dynamic.title(f'Негативный сценарий: гостевой пользователь не может получить siblings (kind={kind})')\n        kind_id = request.getfixturevalue(kind_id_fixture)\n    \n        with allure.step('Создаём документ владельцем'):\n            create_resp = owner_client.post(\n                **create_document_endpoint(kind=kind, kind_id=kind_id, space_id=space_id_function, title='UnauthorizedDoc')\n            )\n            assert create_resp.status_code == 200, f'Не удалось создать документ: {create_resp.text}'\n            doc_id = create_resp.json()['payload']['document']['_id']\n    \n        with allure.step('Пытаемся получить сиблинги как гость'):\n            resp = guest_client.post(**get_document_siblings_endpoint(document_id=doc_id, space_id=space_id_function))\n>           assert resp.status_code == 403, f'Ожидался 403, но получен {resp.status_code}'\nE           AssertionError: Ожидался 403, но получен 520\nE           assert 520 == 403\nE            +  where 520 = <Response [520]>.status_code\n\ntests/test_backend/document/test_get_siblings.py:369: AssertionError","flaky":true,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"owner_client","time":{"start":1762519954304,"stop":1762519954760,"duration":456},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1762519954304,"stop":1762519954304,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1762519954304,"stop":1762519954304,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1762519954304,"stop":1762519954304,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1762519954304,"stop":1762519954304,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"guest_client","time":{"start":1762519959001,"stop":1762519959251,"duration":250},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"space_id_function","time":{"start":1762520290355,"stop":1762520290832,"duration":477},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_id_function","time":{"start":1762520290833,"stop":1762520291261,"duration":428},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: Ожидался 403, но получен 520\nassert 520 == 403\n +  where 520 = <Response [520]>.status_code","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f292e507e90>\nguest_client = <tests.core.client.APIClient object at 0x7f292e5bf390>\nrequest = <FixtureRequest for <Function test_get_document_siblings_foreign_space[project]>>\nkind = 'Project', kind_id_fixture = 'project_id_function'\nspace_id_function = '690dece24aa117e4bab2de1b'\n\n    @pytest.mark.parametrize(\n        'kind, kind_id_fixture',\n        [\n            ('Project', 'project_id_function'),\n            ('Space', 'space_id_function'),\n            ('Member', 'member_id_function'),\n        ],\n        ids=['project', 'space', 'member'],\n    )\n    def test_get_document_siblings_foreign_space(\n        owner_client, guest_client, request, kind, kind_id_fixture, space_id_function\n    ):\n        allure.dynamic.title(f'Негативный сценарий: гостевой пользователь не может получить siblings (kind={kind})')\n        kind_id = request.getfixturevalue(kind_id_fixture)\n    \n        with allure.step('Создаём документ владельцем'):\n            create_resp = owner_client.post(\n                **create_document_endpoint(kind=kind, kind_id=kind_id, space_id=space_id_function, title='UnauthorizedDoc')\n            )\n            assert create_resp.status_code == 200, f'Не удалось создать документ: {create_resp.text}'\n            doc_id = create_resp.json()['payload']['document']['_id']\n    \n        with allure.step('Пытаемся получить сиблинги как гость'):\n            resp = guest_client.post(**get_document_siblings_endpoint(document_id=doc_id, space_id=space_id_function))\n>           assert resp.status_code == 403, f'Ожидался 403, но получен {resp.status_code}'\nE           AssertionError: Ожидался 403, но получен 520\nE           assert 520 == 403\nE            +  where 520 = <Response [520]>.status_code\n\ntests/test_backend/document/test_get_siblings.py:369: AssertionError","steps":[{"name":"Создаём документ владельцем","time":{"start":1762520291261,"stop":1762520291523,"duration":262},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Пытаемся получить сиблинги как гость","time":{"start":1762520291523,"stop":1762520305137,"duration":13614},"status":"failed","statusMessage":"AssertionError: Ожидался 403, но получен 520\nassert 520 == 403\n +  where 520 = <Response [520]>.status_code\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/document/test_get_siblings.py\", line 369, in test_get_document_siblings_foreign_space\n    assert resp.status_code == 403, f'Ожидался 403, но получен {resp.status_code}'\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":2,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"project_id_function::0","time":{"start":1762520305164,"stop":1762520305164,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"space_id_function::0","time":{"start":1762520305165,"stop":1762520305535,"duration":370},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"backend"},{"name":"parentSuite","value":"tests.test_backend.document"},{"name":"suite","value":"test_get_siblings"},{"name":"host","value":"runnervmf2e7y"},{"name":"thread","value":"2595-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.document.test_get_siblings"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"kind","value":"'Project'"},{"name":"kind_id_fixture","value":"'project_id_function'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":3,"broken":0,"skipped":0,"passed":14,"unknown":0,"total":17},"items":[{"uid":"afaa53620331b398","reportUrl":"https://vaizcom.github.io/autotests/422/#testresult/afaa53620331b398","status":"passed","time":{"start":1762517299205,"stop":1762517300414,"duration":1209}},{"uid":"7556371ea0259bb","reportUrl":"https://vaizcom.github.io/autotests/421/#testresult/7556371ea0259bb","status":"failed","statusDetails":"AssertionError: assert 400 == 200\n +  where 400 = <Response [400]>.status_code","time":{"start":1762514874028,"stop":1762514874028,"duration":0}},{"uid":"fffd29d005545a6d","reportUrl":"https://vaizcom.github.io/autotests/420/#testresult/fffd29d005545a6d","status":"passed","time":{"start":1762507784758,"stop":1762507785975,"duration":1217}},{"uid":"6181bb4a97f91cf3","reportUrl":"https://vaizcom.github.io/autotests/420/#testresult/6181bb4a97f91cf3","status":"failed","statusDetails":"AssertionError: assert 503 == 200\n +  where 503 = <Response [503]>.status_code","time":{"start":1762506275936,"stop":1762506275936,"duration":0}},{"uid":"c98ab93d6809cfe4","reportUrl":"https://vaizcom.github.io/autotests/419/#testresult/c98ab93d6809cfe4","status":"passed","time":{"start":1762505589426,"stop":1762505590408,"duration":982}},{"uid":"8e457b03f708c4de","reportUrl":"https://vaizcom.github.io/autotests/418/#testresult/8e457b03f708c4de","status":"passed","time":{"start":1762354571698,"stop":1762354572791,"duration":1093}},{"uid":"38abeb70bf4b0839","reportUrl":"https://vaizcom.github.io/autotests/417/#testresult/38abeb70bf4b0839","status":"passed","time":{"start":1762353518759,"stop":1762353520012,"duration":1253}},{"uid":"91d644d776ceab8a","reportUrl":"https://vaizcom.github.io/autotests/416/#testresult/91d644d776ceab8a","status":"passed","time":{"start":1762350107261,"stop":1762350108498,"duration":1237}},{"uid":"8e6938d7219759ed","reportUrl":"https://vaizcom.github.io/autotests/415/#testresult/8e6938d7219759ed","status":"passed","time":{"start":1762332062049,"stop":1762332063122,"duration":1073}},{"uid":"5dd008245ea6bf1d","reportUrl":"https://vaizcom.github.io/autotests/414/#testresult/5dd008245ea6bf1d","status":"passed","time":{"start":1762329131561,"stop":1762329133022,"duration":1461}},{"uid":"effd4f1772f82391","reportUrl":"https://vaizcom.github.io/autotests/413/#testresult/effd4f1772f82391","status":"passed","time":{"start":1762270737909,"stop":1762270739069,"duration":1160}},{"uid":"239e388ee18380e7","reportUrl":"https://vaizcom.github.io/autotests/412/#testresult/239e388ee18380e7","status":"passed","time":{"start":1762269978893,"stop":1762269979979,"duration":1086}},{"uid":"6ec6f241b4aa3631","reportUrl":"https://vaizcom.github.io/autotests/411/#testresult/6ec6f241b4aa3631","status":"passed","time":{"start":1762269876477,"stop":1762269878557,"duration":2080}},{"uid":"155da6bec834583","reportUrl":"https://vaizcom.github.io/autotests/410/#testresult/155da6bec834583","status":"passed","time":{"start":1762269619548,"stop":1762269621585,"duration":2037}},{"uid":"a348872f2a60a3f5","reportUrl":"https://vaizcom.github.io/autotests/409/#testresult/a348872f2a60a3f5","status":"passed","time":{"start":1762268952571,"stop":1762268953617,"duration":1046}},{"uid":"bbb30b2b53eee322","reportUrl":"https://vaizcom.github.io/autotests/408/#testresult/bbb30b2b53eee322","status":"passed","time":{"start":1762245359710,"stop":1762245361570,"duration":1860}}]},"tags":["backend"]},"source":"6ce0b70d303933d3.json","parameterValues":["'Project'","'project_id_function'"]}