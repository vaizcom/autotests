{"uid":"208ae8d677279772","name":"Доступ к таскам спейса под ролью Manager (HTTP 200)","fullName":"tests.test_backend.task_service.get_tasks.access_get_tasks.test_get_tasks_space_all#test_get_tasks_by_role_in_second_space","historyId":"5351bddcd45383966562032e8a657db5","time":{"start":1763996499446,"stop":1763996535789,"duration":36343},"description":"\n    Проверка доступа ко всем таскам в спейсе для всех ролей:\n    - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\n    TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n    (сейчас указан спейс в котором нет архивных тасок)\n    ","descriptionHtml":"<pre><code>Проверка доступа ко всем таскам в спейсе для всех ролей:\n- роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\nTODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n(сейчас указан спейс в котором нет архивных тасок)\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452","statusTrace":"request = <FixtureRequest for <Function test_get_tasks_by_role_in_second_space[manager]>>\nclient_fixture = 'manager_client', expected_status = 200\nsecond_space = '691adf9e4bfde6405d9feb3a'\nsecond_project = '691adf9f4bfde6405d9feb4a'\nmain_project = '686672af85fb8d104544e798'\n\n    @allure.title(\"GetTasks: Проверка доступа к задачам спейса для всех ролей (без фильтраций)\")\n    @pytest.mark.parametrize(\n        'client_fixture, expected_status',\n        [\n            ('owner_client', 200),\n            ('manager_client', 200),\n            ('member_client', 200),\n            ('guest_client', 200)\n        ],\n        ids=['owner', 'manager', 'member', 'guest'],\n    )\n    def test_get_tasks_by_role_in_second_space(request, client_fixture, expected_status, second_space, second_project, main_project):\n        \"\"\"\n        Проверка доступа ко всем таскам в спейсе для всех ролей:\n        - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n    \n        TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n        (сейчас указан спейс в котором нет архивных тасок)\n        \"\"\"\n        client = request.getfixturevalue(client_fixture)\n        role_name = client_fixture.replace('_client', '').capitalize()\n        allure.dynamic.title(f\"Доступ к таскам спейса под ролью {role_name} (HTTP {expected_status})\")\n    \n        with allure.step(f\"{client_fixture}: вызвать GetTasks без фильтров\"):\n            resp = client.post(**get_tasks_endpoint(space_id=second_space))\n    \n        with allure.step(f\"Проверить HTTP {expected_status}\"):\n            assert resp.status_code == expected_status\n    \n        with allure.step(\"Проверить payload\"):\n            payload = resp.json().get(\"payload\", {})\n            assert \"tasks\" in payload and isinstance(payload[\"tasks\"], list)\n            tasks = payload[\"tasks\"]\n    \n        if not tasks:\n            pytest.skip(\"Список задач пуст — нечего валидировать\")\n    \n        # Жёсткая проверка: каждая задача должна принадлежать только second_project\n        with allure.step(\"Проверить отсутствие задач из другого спейса)\"):\n            for task in tasks[:20]:\n                assert \"project\" in task, f\"У задачи {task.get('_id', 'unknown')} отсутствует поле project\"\n>               assert task.get(\"project\") == second_project, (\n                    f\"Задача {task.get('_id', 'unknown')} принадлежит другому проекту: {task.get('project')}, \"\n                    f\"ожидался {second_project}\"\n                    )\nE               AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nE               assert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\nE                 \nE                 - 691adf9f4bfde6405d9feb4a\nE                 + 63286261a466b6becd9d6452\n\ntests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py:49: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"description":"\n    Проверка доступа ко всем таскам в спейсе для всех ролей:\n    - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\n    TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n    (сейчас указан спейс в котором нет архивных тасок)\n    ","status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452","statusTrace":"request = <FixtureRequest for <Function test_get_tasks_by_role_in_second_space[manager]>>\nclient_fixture = 'manager_client', expected_status = 200\nsecond_space = '691adf9e4bfde6405d9feb3a'\nsecond_project = '691adf9f4bfde6405d9feb4a'\nmain_project = '686672af85fb8d104544e798'\n\n    @allure.title(\"GetTasks: Проверка доступа к задачам спейса для всех ролей (без фильтраций)\")\n    @pytest.mark.parametrize(\n        'client_fixture, expected_status',\n        [\n            ('owner_client', 200),\n            ('manager_client', 200),\n            ('member_client', 200),\n            ('guest_client', 200)\n        ],\n        ids=['owner', 'manager', 'member', 'guest'],\n    )\n    def test_get_tasks_by_role_in_second_space(request, client_fixture, expected_status, second_space, second_project, main_project):\n        \"\"\"\n        Проверка доступа ко всем таскам в спейсе для всех ролей:\n        - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n    \n        TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n        (сейчас указан спейс в котором нет архивных тасок)\n        \"\"\"\n        client = request.getfixturevalue(client_fixture)\n        role_name = client_fixture.replace('_client', '').capitalize()\n        allure.dynamic.title(f\"Доступ к таскам спейса под ролью {role_name} (HTTP {expected_status})\")\n    \n        with allure.step(f\"{client_fixture}: вызвать GetTasks без фильтров\"):\n            resp = client.post(**get_tasks_endpoint(space_id=second_space))\n    \n        with allure.step(f\"Проверить HTTP {expected_status}\"):\n            assert resp.status_code == expected_status\n    \n        with allure.step(\"Проверить payload\"):\n            payload = resp.json().get(\"payload\", {})\n            assert \"tasks\" in payload and isinstance(payload[\"tasks\"], list)\n            tasks = payload[\"tasks\"]\n    \n        if not tasks:\n            pytest.skip(\"Список задач пуст — нечего валидировать\")\n    \n        # Жёсткая проверка: каждая задача должна принадлежать только second_project\n        with allure.step(\"Проверить отсутствие задач из другого спейса)\"):\n            for task in tasks[:20]:\n                assert \"project\" in task, f\"У задачи {task.get('_id', 'unknown')} отсутствует поле project\"\n>               assert task.get(\"project\") == second_project, (\n                    f\"Задача {task.get('_id', 'unknown')} принадлежит другому проекту: {task.get('project')}, \"\n                    f\"ожидался {second_project}\"\n                    )\nE               AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nE               assert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\nE                 \nE                 - 691adf9f4bfde6405d9feb4a\nE                 + 63286261a466b6becd9d6452\n\ntests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py:49: AssertionError","steps":[{"name":"manager_client: вызвать GetTasks без фильтров","time":{"start":1763996499446,"stop":1763996535169,"duration":35723},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить HTTP 200","time":{"start":1763996535169,"stop":1763996535169,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить payload","time":{"start":1763996535169,"stop":1763996535788,"duration":619},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить отсутствие задач из другого спейса)","time":{"start":1763996535788,"stop":1763996535788,"duration":0},"status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py\", line 49, in test_get_tasks_by_role_in_second_space\n    assert task.get(\"project\") == second_project, (\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":4,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"tag","value":"backend"},{"name":"parentSuite","value":"tests.test_backend.task_service.get_tasks.access_get_tasks"},{"name":"suite","value":"test_get_tasks_space_all"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"2653-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.task_service.get_tasks.access_get_tasks.test_get_tasks_space_all"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"client_fixture","value":"'manager_client'"},{"name":"expected_status","value":"200"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":19,"unknown":0,"total":20},"items":[{"uid":"fa2da162b2f50ea6","reportUrl":"https://vaizcom.github.io/autotests/470/#testresult/fa2da162b2f50ea6","status":"passed","time":{"start":1763995227475,"stop":1763995227726,"duration":251}},{"uid":"bb3409470e1bafe6","reportUrl":"https://vaizcom.github.io/autotests/469/#testresult/bb3409470e1bafe6","status":"passed","time":{"start":1763993480537,"stop":1763993480774,"duration":237}},{"uid":"7d5fb1fc265263b8","reportUrl":"https://vaizcom.github.io/autotests/468/#testresult/7d5fb1fc265263b8","status":"passed","time":{"start":1763734845477,"stop":1763734845739,"duration":262}},{"uid":"14732346e0beecf7","reportUrl":"https://vaizcom.github.io/autotests/467/#testresult/14732346e0beecf7","status":"passed","time":{"start":1763733026069,"stop":1763733026368,"duration":299}},{"uid":"6597fa7a5d2afde1","reportUrl":"https://vaizcom.github.io/autotests/466/#testresult/6597fa7a5d2afde1","status":"passed","time":{"start":1763726679426,"stop":1763726679963,"duration":537}},{"uid":"db763330e0248fa","reportUrl":"https://vaizcom.github.io/autotests/465/#testresult/db763330e0248fa","status":"passed","time":{"start":1763720220074,"stop":1763720220289,"duration":215}},{"uid":"62fd3ea970a12c8f","reportUrl":"https://vaizcom.github.io/autotests/464/#testresult/62fd3ea970a12c8f","status":"passed","time":{"start":1763715530095,"stop":1763715530281,"duration":186}},{"uid":"41ab139491349a1f","reportUrl":"https://vaizcom.github.io/autotests/463/#testresult/41ab139491349a1f","status":"passed","time":{"start":1763714950235,"stop":1763714950506,"duration":271}},{"uid":"725c4552f976e3e","reportUrl":"https://vaizcom.github.io/autotests/462/#testresult/725c4552f976e3e","status":"passed","time":{"start":1763711384207,"stop":1763711384411,"duration":204}},{"uid":"897e2bfd2402b580","reportUrl":"https://vaizcom.github.io/autotests/461/#testresult/897e2bfd2402b580","status":"passed","time":{"start":1763710406430,"stop":1763710406681,"duration":251}},{"uid":"b252b04a0647e5ad","reportUrl":"https://vaizcom.github.io/autotests/460/#testresult/b252b04a0647e5ad","status":"passed","time":{"start":1763651933177,"stop":1763651933398,"duration":221}},{"uid":"436582f8a46c90af","reportUrl":"https://vaizcom.github.io/autotests/459/#testresult/436582f8a46c90af","status":"passed","time":{"start":1763650072907,"stop":1763650073124,"duration":217}},{"uid":"b8e3fb93e38f566c","reportUrl":"https://vaizcom.github.io/autotests/458/#testresult/b8e3fb93e38f566c","status":"passed","time":{"start":1763631445888,"stop":1763631446069,"duration":181}},{"uid":"7938afeceb1d227a","reportUrl":"https://vaizcom.github.io/autotests/457/#testresult/7938afeceb1d227a","status":"passed","time":{"start":1763628802787,"stop":1763628802981,"duration":194}},{"uid":"32b1608da133174b","reportUrl":"https://vaizcom.github.io/autotests/456/#testresult/32b1608da133174b","status":"passed","time":{"start":1763559939970,"stop":1763559940236,"duration":266}},{"uid":"786f9c0683270847","reportUrl":"https://vaizcom.github.io/autotests/455/#testresult/786f9c0683270847","status":"passed","time":{"start":1763542887895,"stop":1763542888215,"duration":320}},{"uid":"d66effb54710fcb1","reportUrl":"https://vaizcom.github.io/autotests/454/#testresult/d66effb54710fcb1","status":"passed","time":{"start":1763540615101,"stop":1763540615323,"duration":222}},{"uid":"4597c507cc01edfa","reportUrl":"https://vaizcom.github.io/autotests/453/#testresult/4597c507cc01edfa","status":"passed","time":{"start":1763478067642,"stop":1763478067894,"duration":252}},{"uid":"61de12d3d29483e4","reportUrl":"https://vaizcom.github.io/autotests/452/#testresult/61de12d3d29483e4","status":"passed","time":{"start":1763476249281,"stop":1763476249480,"duration":199}}]},"tags":["backend"]},"source":"208ae8d677279772.json","parameterValues":["'manager_client'","200"]}