{"uid":"46fa19acc5edd2c0","name":"Проверка связи родительской задачи и подзадачи, корректность отображения 'parentTask' и 'subtasks'","fullName":"tests.test_backend.task_service.create_task.test_subtask_parent_relationships#test_subtask_parent_child_relationships","historyId":"91eaca27135b9b296aa5a1c62b464df2","time":{"start":1765881293667,"stop":1765881302722,"duration":9055},"description":"\n    тест проверяет связи родительской задачи и подзадачи через get_task_endpoint,\n    а также корректное заполнение полей 'parentTask' и 'subtasks'.\n    ","descriptionHtml":"<pre><code>тест проверяет связи родительской задачи и подзадачи через get_task_endpoint,\nа также корректное заполнение полей 'parentTask' и 'subtasks'.\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: Не удалось удалить родителя 694135d1ca358733d9fe0850: {\"payload\":null,\"type\":\"DeleteTask\",\"error\":{\"code\":\"InternalServerError\",\"fields\":[],\"originalType\":\"DeleteTask\",\"meta\":{\"context\":\"MongoServerError\",\"message\":\"Caused by :: Write conflict during plan execution and yielding is disabled. :: Please retry your operation or multi-document transaction.\"}}}\nassert 400 == 200\n +  where 400 = <Response [400]>.status_code","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f0b048a7d10>\nmain_space = '6866309d85fb8d104544a61e'\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f0b047ee340>\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка связи родительской задачи и подзадачи, корректность отображения 'parentTask' и 'subtasks'\")\n    def test_subtask_parent_child_relationships(\n        owner_client, main_space, create_task_in_main\n    ):\n        \"\"\"\n        тест проверяет связи родительской задачи и подзадачи через get_task_endpoint,\n        а также корректное заполнение полей 'parentTask' и 'subtasks'.\n        \"\"\"\n        parent_id = subtask_id = None\n    \n        # Создаём родительскую задачу и подзадачу, чтобы проверить связи\n        with allure.step(\"Создание родительской задачи в роли owner_client\"):\n            parent_task = create_task_in_main(\n                \"owner_client\",\n                name=\"Parent task for relationship check\"\n            )\n            parent_id = parent_task[\"_id\"]\n            parent_slug = parent_task[\"hrid\"]\n    \n        try:\n            with allure.step(\"Создание подзадачи в роли owner_client\"):\n                subtask = create_task_in_main(\n                    \"owner_client\",\n                    name=\"Subtask for relationship check\",\n                    parent_task=parent_id\n                )\n                subtask_id = subtask[\"_id\"]\n                subtask_slug = subtask[\"hrid\"]\n    \n            with allure.step('Проверяем наличие родительской задачи через get_task_endpoint'):\n                resp_parent = owner_client.post(**get_task_endpoint(slug_id=parent_id, space_id=main_space)) # в slug_id можно передать id или slug\n                assert resp_parent.status_code == 200, f'Не удалось получить родительскую задачу: {resp_parent.status_code}'\n                parent = resp_parent.json()[\"payload\"].get(\"task\")\n                assert parent is not None, f\"Родительская задача (slug={parent_slug}) не найдена\"\n    \n            with allure.step('Проверяем наличие подзадачи через get_task_endpoint'):\n                resp_sub = owner_client.post(**get_task_endpoint(slug_id=subtask_id, space_id=main_space))\n                assert resp_sub.status_code == 200, f'Не удалось получить подзадачу: {resp_sub.status_code}'\n                sub = resp_sub.json()[\"payload\"].get(\"task\")\n                assert sub is not None, f\"Подзадача (slug={subtask_slug}) не найдена\"\n    \n            with allure.step(\"Проверяем что у родителя есть подзадача (subtasks), но нет parentTask\"):\n                assert subtask_id in parent.get(\"subtasks\", []), \\\n                    f\"subtask_id {subtask_id} не найден в subtasks родителя: {parent.get('subtasks', [])}\"\n                assert parent.get(\"parentTask\") is None, \\\n                    f\"parentTask у родителя должен быть None, сейчас: {parent.get('parentTask')}\"\n    \n            with allure.step(\"Проверяем что у сабтаски есть parentTask и пустой subtasks\"):\n                assert sub.get(\"parentTask\") == parent_id, \\\n                    f\"parentTask у сабтаски должен быть {parent_id}, сейчас: {sub.get('parentTask')}\"\n                assert sub.get(\"subtasks\", []) == [], \\\n                    f\"subtasks у сабтаски должен быть пустым списком, сейчас: {sub.get('subtasks')}\"\n    \n        finally:\n            if subtask_id:\n                with allure.step(\"Удаляем сабтаску\"):\n                    resp = owner_client.post(**delete_task_endpoint(task_id=subtask_id, space_id=main_space))\n                    assert resp.status_code == 200, f\"Не удалось удалить сабтаску {subtask_id}: {resp.text}\"\n            if parent_id:\n                with allure.step(\"Удаляем родительскую задачу\"):\n                    resp = owner_client.post(**delete_task_endpoint(task_id=parent_id, space_id=main_space))\n>                   assert resp.status_code == 200, f\"Не удалось удалить родителя {parent_id}: {resp.text}\"\nE                   AssertionError: Не удалось удалить родителя 694135d1ca358733d9fe0850: {\"payload\":null,\"type\":\"DeleteTask\",\"error\":{\"code\":\"InternalServerError\",\"fields\":[],\"originalType\":\"DeleteTask\",\"meta\":{\"context\":\"MongoServerError\",\"message\":\"Caused by :: Write conflict during plan execution and yielding is disabled. :: Please retry your operation or multi-document transaction.\"}}}\nE                   assert 400 == 200\nE                    +  where 400 = <Response [400]>.status_code\n\ntests/test_backend/task_service/create_task/test_subtask_parent_relationships.py:73: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"pytestconfig","time":{"start":1765880720314,"stop":1765880720314,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1765880720314,"stop":1765880720314,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"owner_client","time":{"start":1765880720314,"stop":1765880720793,"duration":479},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1765880720314,"stop":1765880720314,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1765880720314,"stop":1765880720314,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_client","time":{"start":1765880724558,"stop":1765880724860,"duration":302},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_space","time":{"start":1765880724860,"stop":1765880725415,"duration":555},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_project","time":{"start":1765880725415,"stop":1765880725849,"duration":434},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_board","time":{"start":1765880730526,"stop":1765880730794,"duration":268},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"create_task_in_main","time":{"start":1765881293667,"stop":1765881293667,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    тест проверяет связи родительской задачи и подзадачи через get_task_endpoint,\n    а также корректное заполнение полей 'parentTask' и 'subtasks'.\n    ","status":"failed","statusMessage":"AssertionError: Не удалось удалить родителя 694135d1ca358733d9fe0850: {\"payload\":null,\"type\":\"DeleteTask\",\"error\":{\"code\":\"InternalServerError\",\"fields\":[],\"originalType\":\"DeleteTask\",\"meta\":{\"context\":\"MongoServerError\",\"message\":\"Caused by :: Write conflict during plan execution and yielding is disabled. :: Please retry your operation or multi-document transaction.\"}}}\nassert 400 == 200\n +  where 400 = <Response [400]>.status_code","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f0b048a7d10>\nmain_space = '6866309d85fb8d104544a61e'\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f0b047ee340>\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка связи родительской задачи и подзадачи, корректность отображения 'parentTask' и 'subtasks'\")\n    def test_subtask_parent_child_relationships(\n        owner_client, main_space, create_task_in_main\n    ):\n        \"\"\"\n        тест проверяет связи родительской задачи и подзадачи через get_task_endpoint,\n        а также корректное заполнение полей 'parentTask' и 'subtasks'.\n        \"\"\"\n        parent_id = subtask_id = None\n    \n        # Создаём родительскую задачу и подзадачу, чтобы проверить связи\n        with allure.step(\"Создание родительской задачи в роли owner_client\"):\n            parent_task = create_task_in_main(\n                \"owner_client\",\n                name=\"Parent task for relationship check\"\n            )\n            parent_id = parent_task[\"_id\"]\n            parent_slug = parent_task[\"hrid\"]\n    \n        try:\n            with allure.step(\"Создание подзадачи в роли owner_client\"):\n                subtask = create_task_in_main(\n                    \"owner_client\",\n                    name=\"Subtask for relationship check\",\n                    parent_task=parent_id\n                )\n                subtask_id = subtask[\"_id\"]\n                subtask_slug = subtask[\"hrid\"]\n    \n            with allure.step('Проверяем наличие родительской задачи через get_task_endpoint'):\n                resp_parent = owner_client.post(**get_task_endpoint(slug_id=parent_id, space_id=main_space)) # в slug_id можно передать id или slug\n                assert resp_parent.status_code == 200, f'Не удалось получить родительскую задачу: {resp_parent.status_code}'\n                parent = resp_parent.json()[\"payload\"].get(\"task\")\n                assert parent is not None, f\"Родительская задача (slug={parent_slug}) не найдена\"\n    \n            with allure.step('Проверяем наличие подзадачи через get_task_endpoint'):\n                resp_sub = owner_client.post(**get_task_endpoint(slug_id=subtask_id, space_id=main_space))\n                assert resp_sub.status_code == 200, f'Не удалось получить подзадачу: {resp_sub.status_code}'\n                sub = resp_sub.json()[\"payload\"].get(\"task\")\n                assert sub is not None, f\"Подзадача (slug={subtask_slug}) не найдена\"\n    \n            with allure.step(\"Проверяем что у родителя есть подзадача (subtasks), но нет parentTask\"):\n                assert subtask_id in parent.get(\"subtasks\", []), \\\n                    f\"subtask_id {subtask_id} не найден в subtasks родителя: {parent.get('subtasks', [])}\"\n                assert parent.get(\"parentTask\") is None, \\\n                    f\"parentTask у родителя должен быть None, сейчас: {parent.get('parentTask')}\"\n    \n            with allure.step(\"Проверяем что у сабтаски есть parentTask и пустой subtasks\"):\n                assert sub.get(\"parentTask\") == parent_id, \\\n                    f\"parentTask у сабтаски должен быть {parent_id}, сейчас: {sub.get('parentTask')}\"\n                assert sub.get(\"subtasks\", []) == [], \\\n                    f\"subtasks у сабтаски должен быть пустым списком, сейчас: {sub.get('subtasks')}\"\n    \n        finally:\n            if subtask_id:\n                with allure.step(\"Удаляем сабтаску\"):\n                    resp = owner_client.post(**delete_task_endpoint(task_id=subtask_id, space_id=main_space))\n                    assert resp.status_code == 200, f\"Не удалось удалить сабтаску {subtask_id}: {resp.text}\"\n            if parent_id:\n                with allure.step(\"Удаляем родительскую задачу\"):\n                    resp = owner_client.post(**delete_task_endpoint(task_id=parent_id, space_id=main_space))\n>                   assert resp.status_code == 200, f\"Не удалось удалить родителя {parent_id}: {resp.text}\"\nE                   AssertionError: Не удалось удалить родителя 694135d1ca358733d9fe0850: {\"payload\":null,\"type\":\"DeleteTask\",\"error\":{\"code\":\"InternalServerError\",\"fields\":[],\"originalType\":\"DeleteTask\",\"meta\":{\"context\":\"MongoServerError\",\"message\":\"Caused by :: Write conflict during plan execution and yielding is disabled. :: Please retry your operation or multi-document transaction.\"}}}\nE                   assert 400 == 200\nE                    +  where 400 = <Response [400]>.status_code\n\ntests/test_backend/task_service/create_task/test_subtask_parent_relationships.py:73: AssertionError","steps":[{"name":"Создание родительской задачи в роли owner_client","time":{"start":1765881293667,"stop":1765881297646,"duration":3979},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Создание подзадачи в роли owner_client","time":{"start":1765881297646,"stop":1765881299869,"duration":2223},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверяем наличие родительской задачи через get_task_endpoint","time":{"start":1765881299869,"stop":1765881300518,"duration":649},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверяем наличие подзадачи через get_task_endpoint","time":{"start":1765881300518,"stop":1765881301127,"duration":609},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверяем что у родителя есть подзадача (subtasks), но нет parentTask","time":{"start":1765881301127,"stop":1765881301127,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверяем что у сабтаски есть parentTask и пустой subtasks","time":{"start":1765881301127,"stop":1765881301127,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Удаляем сабтаску","time":{"start":1765881301127,"stop":1765881301955,"duration":828},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Удаляем родительскую задачу","time":{"start":1765881301955,"stop":1765881302721,"duration":766},"status":"failed","statusMessage":"AssertionError: Не удалось удалить родителя 694135d1ca358733d9fe0850: {\"payload\":null,\"type\":\"DeleteTask\",\"error\":{\"code\":\"InternalServerError\",\"fields\":[],\"originalType\":\"DeleteTask\",\"meta\":{\"context\":\"MongoServerError\",\"message\":\"Caused by :: Write conflict during plan execution and yielding is disabled. :: Please retry your operation or multi-document transaction.\"}}}\nassert 400 == 200\n +  where 400 = <Response [400]>.status_code\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/create_task/test_subtask_parent_relationships.py\", line 73, in test_subtask_parent_child_relationships\n    assert resp.status_code == 200, f\"Не удалось удалить родителя {parent_id}: {resp.text}\"\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":8,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"create_task"},{"name":"tag","value":"backend"},{"name":"suite","value":"test_subtask_parent_relationships"},{"name":"host","value":"runnervm6qbrg"},{"name":"thread","value":"2627-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.task_service.create_task.test_subtask_parent_relationships"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":6,"skipped":0,"passed":99,"unknown":0,"total":106},"items":[{"uid":"38699f23e59cd896","reportUrl":"https://vaizcom.github.io/autotests/509/#testresult/38699f23e59cd896","status":"passed","time":{"start":1765880834803,"stop":1765880840857,"duration":6054}},{"uid":"3a36ab92f75d581e","reportUrl":"https://vaizcom.github.io/autotests/508/#testresult/3a36ab92f75d581e","status":"passed","time":{"start":1765874686147,"stop":1765874689034,"duration":2887}},{"uid":"6a3b168e41b94d8d","reportUrl":"https://vaizcom.github.io/autotests/507/#testresult/6a3b168e41b94d8d","status":"passed","time":{"start":1765809823648,"stop":1765809829182,"duration":5534}},{"uid":"9842ceb7adadfc33","reportUrl":"https://vaizcom.github.io/autotests/506/#testresult/9842ceb7adadfc33","status":"passed","time":{"start":1765789262170,"stop":1765789268801,"duration":6631}},{"uid":"4072317b542e0263","reportUrl":"https://vaizcom.github.io/autotests/505/#testresult/4072317b542e0263","status":"passed","time":{"start":1765786208545,"stop":1765786213101,"duration":4556}},{"uid":"390cf478cdaacf44","reportUrl":"https://vaizcom.github.io/autotests/504/#testresult/390cf478cdaacf44","status":"passed","time":{"start":1765552768115,"stop":1765552771908,"duration":3793}},{"uid":"cf34f3574b9df6b6","reportUrl":"https://vaizcom.github.io/autotests/503/#testresult/cf34f3574b9df6b6","status":"passed","time":{"start":1765551457367,"stop":1765551460903,"duration":3536}},{"uid":"588ec91494131129","reportUrl":"https://vaizcom.github.io/autotests/502/#testresult/588ec91494131129","status":"passed","time":{"start":1765550108658,"stop":1765550114043,"duration":5385}},{"uid":"466d40cf7d7bf28a","reportUrl":"https://vaizcom.github.io/autotests/501/#testresult/466d40cf7d7bf28a","status":"passed","time":{"start":1765544192122,"stop":1765544195345,"duration":3223}},{"uid":"a82f8f7810f7d132","reportUrl":"https://vaizcom.github.io/autotests/500/#testresult/a82f8f7810f7d132","status":"passed","time":{"start":1765526039232,"stop":1765526042926,"duration":3694}},{"uid":"844bc8f240013010","reportUrl":"https://vaizcom.github.io/autotests/499/#testresult/844bc8f240013010","status":"passed","time":{"start":1765457805776,"stop":1765457809026,"duration":3250}},{"uid":"663ebef20861e63","reportUrl":"https://vaizcom.github.io/autotests/498/#testresult/663ebef20861e63","status":"passed","time":{"start":1765444032745,"stop":1765444036621,"duration":3876}},{"uid":"8572715ec844839f","reportUrl":"https://vaizcom.github.io/autotests/497/#testresult/8572715ec844839f","status":"passed","time":{"start":1765442119328,"stop":1765442123246,"duration":3918}},{"uid":"94f1202d95a28d4b","reportUrl":"https://vaizcom.github.io/autotests/496/#testresult/94f1202d95a28d4b","status":"passed","time":{"start":1765372587788,"stop":1765372591609,"duration":3821}},{"uid":"f29402cb5ddc54e9","reportUrl":"https://vaizcom.github.io/autotests/495/#testresult/f29402cb5ddc54e9","status":"passed","time":{"start":1765274018962,"stop":1765274027905,"duration":8943}},{"uid":"3874da72633b32c3","reportUrl":"https://vaizcom.github.io/autotests/494/#testresult/3874da72633b32c3","status":"passed","time":{"start":1765206344749,"stop":1765206348092,"duration":3343}},{"uid":"c021710a95e5800a","reportUrl":"https://vaizcom.github.io/autotests/493/#testresult/c021710a95e5800a","status":"passed","time":{"start":1765203225422,"stop":1765203229046,"duration":3624}},{"uid":"b2d881e3b95455e4","reportUrl":"https://vaizcom.github.io/autotests/492/#testresult/b2d881e3b95455e4","status":"passed","time":{"start":1765200343144,"stop":1765200346501,"duration":3357}},{"uid":"abfe10b143b6ad51","reportUrl":"https://vaizcom.github.io/autotests/491/#testresult/abfe10b143b6ad51","status":"passed","time":{"start":1765188942730,"stop":1765188945963,"duration":3233}},{"uid":"cf4d561fb829f25d","reportUrl":"https://vaizcom.github.io/autotests/490/#testresult/cf4d561fb829f25d","status":"passed","time":{"start":1765187626282,"stop":1765187629826,"duration":3544}}]},"tags":["backend"]},"source":"46fa19acc5edd2c0.json","parameterValues":[]}