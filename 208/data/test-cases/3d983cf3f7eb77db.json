{"uid":"3d983cf3f7eb77db","name":"Получение сиблингов документа (kind=Space)","fullName":"tests.test_backend.document.test_get_siblings#test_get_document_siblings","historyId":"8376613a8877b3a5f7f6c3a375f40213","time":{"start":1750855029834,"stop":1750855031822,"duration":1988},"status":"failed","statusMessage":"AssertionError: assert {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} is None\n +  where {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} = <built-in method get of dict object at 0x7f491fb6a1c0>('prevSibling')\n +    where <built-in method get of dict object at 0x7f491fb6a1c0> = {'parents': [], 'prevSibling': {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'tree': [{'document': {'_id': '685bed75a2b8f0d475365e41', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed75a2b8f0d475365e41', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685bed76a2b8f0d475365e56', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e56', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685bed76a2b8f0d475365e6e', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e6e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685bed77a2b8f0d475365e88', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed77a2b8f0d475365e88', 'lft': 5, 'rgt': 6}]}.get","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f492190f650>\nrequest = <FixtureRequest for <Function test_get_document_siblings[space]>>\ntemp_space = '685bed26a2b8f0d475364736', kind = 'Space'\nfixture_name = 'temp_space'\n\n    @pytest.mark.parametrize(\n        'kind, fixture_name',\n        [\n            ('Project', 'temp_project'),\n            ('Space', 'temp_space'),\n            ('Member', 'temp_member'),\n        ],\n        ids=['project', 'space', 'member'],\n    )\n    def test_get_document_siblings(owner_client, request, temp_space, kind, fixture_name):\n        kind_id = request.getfixturevalue(fixture_name)\n        allure.dynamic.title(f'Получение сиблингов документа (kind={kind})')\n    \n        with allure.step('Создание родительского документа'):\n            resp = owner_client.post(\n                **create_document_endpoint(kind=kind, kind_id=kind_id, space_id=temp_space, title='Parent')\n            )\n            assert resp.status_code == 200\n            parent_id = resp.json()['payload']['document']['_id']\n    \n        with allure.step('Создание дочерних документов'):\n            titles = ['Child A', 'Child B', 'Child C']\n            indices = [0, 1, 2]\n            child_ids = []\n    \n            for title, index in zip(titles, indices):\n                resp = owner_client.post(\n                    **create_document_endpoint(\n                        kind=kind,\n                        kind_id=kind_id,\n                        space_id=temp_space,\n                        title=title,\n                        parent_document_id=parent_id,\n                        index=index,\n                    )\n                )\n                assert resp.status_code == 200\n                child_ids.append(resp.json()['payload']['document']['_id'])\n    \n        with allure.step('Запрос сиблингов для среднего дочернего документа'):\n            target_id = child_ids[1]\n            resp = owner_client.post(\n                **get_document_siblings_endpoint(document_id=target_id, space_id=temp_space)\n            )\n            assert resp.status_code == 200\n            payload = resp.json()['payload']\n    \n        with allure.step('Проверка корректности сиблингов'):\n            assert payload['prevSibling']['_id'] == child_ids[0]\n            assert payload['nextSibling']['_id'] == child_ids[2]\n            assert payload['parents'][0]['_id'] == parent_id\n            assert any(node['document']['_id'] == target_id for node in payload['tree'])\n    \n        with allure.step('Проверка структуры дерева'):\n            for node in payload['tree']:\n                assert 'document' in node, 'В узле дерева отсутствует поле document'\n    \n        with allure.step('Проверка наличия обязательных полей в document'):\n            required_fields = ['_id', 'title', 'kind', 'kindId']\n            for node in payload['tree']:\n                for field in required_fields:\n                    assert field in node['document'], f'В документе отсутствует поле {field}'\n    \n        with allure.step('Проверка сиблингов родительского документа — их не должно быть'):\n            resp = owner_client.post(\n                **get_document_siblings_endpoint(document_id=parent_id, space_id=temp_space)\n            )\n            assert resp.status_code == 200\n            payload = resp.json()['payload']\n>           assert payload.get('prevSibling') is None\nE           AssertionError: assert {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} is None\nE            +  where {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} = <built-in method get of dict object at 0x7f491fb6a1c0>('prevSibling')\nE            +    where <built-in method get of dict object at 0x7f491fb6a1c0> = {'parents': [], 'prevSibling': {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'tree': [{'document': {'_id': '685bed75a2b8f0d475365e41', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed75a2b8f0d475365e41', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685bed76a2b8f0d475365e56', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e56', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685bed76a2b8f0d475365e6e', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e6e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685bed77a2b8f0d475365e88', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed77a2b8f0d475365e88', 'lft': 5, 'rgt': 6}]}.get\n\ntests/test_backend/document/test_get_siblings.py:81: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_verify_url","time":{"start":1750854949078,"stop":1750854949078,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"pytestconfig","time":{"start":1750854949078,"stop":1750854949078,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"base_url","time":{"start":1750854949078,"stop":1750854949078,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"owner_client","time":{"start":1750854949078,"stop":1750854949680,"duration":602},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"delete_output_dir","time":{"start":1750854949078,"stop":1750854949078,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"temp_space","time":{"start":1750854949680,"stop":1750854950477,"duration":797},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} is None\n +  where {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} = <built-in method get of dict object at 0x7f491fb6a1c0>('prevSibling')\n +    where <built-in method get of dict object at 0x7f491fb6a1c0> = {'parents': [], 'prevSibling': {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'tree': [{'document': {'_id': '685bed75a2b8f0d475365e41', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed75a2b8f0d475365e41', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685bed76a2b8f0d475365e56', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e56', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685bed76a2b8f0d475365e6e', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e6e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685bed77a2b8f0d475365e88', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed77a2b8f0d475365e88', 'lft': 5, 'rgt': 6}]}.get","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f492190f650>\nrequest = <FixtureRequest for <Function test_get_document_siblings[space]>>\ntemp_space = '685bed26a2b8f0d475364736', kind = 'Space'\nfixture_name = 'temp_space'\n\n    @pytest.mark.parametrize(\n        'kind, fixture_name',\n        [\n            ('Project', 'temp_project'),\n            ('Space', 'temp_space'),\n            ('Member', 'temp_member'),\n        ],\n        ids=['project', 'space', 'member'],\n    )\n    def test_get_document_siblings(owner_client, request, temp_space, kind, fixture_name):\n        kind_id = request.getfixturevalue(fixture_name)\n        allure.dynamic.title(f'Получение сиблингов документа (kind={kind})')\n    \n        with allure.step('Создание родительского документа'):\n            resp = owner_client.post(\n                **create_document_endpoint(kind=kind, kind_id=kind_id, space_id=temp_space, title='Parent')\n            )\n            assert resp.status_code == 200\n            parent_id = resp.json()['payload']['document']['_id']\n    \n        with allure.step('Создание дочерних документов'):\n            titles = ['Child A', 'Child B', 'Child C']\n            indices = [0, 1, 2]\n            child_ids = []\n    \n            for title, index in zip(titles, indices):\n                resp = owner_client.post(\n                    **create_document_endpoint(\n                        kind=kind,\n                        kind_id=kind_id,\n                        space_id=temp_space,\n                        title=title,\n                        parent_document_id=parent_id,\n                        index=index,\n                    )\n                )\n                assert resp.status_code == 200\n                child_ids.append(resp.json()['payload']['document']['_id'])\n    \n        with allure.step('Запрос сиблингов для среднего дочернего документа'):\n            target_id = child_ids[1]\n            resp = owner_client.post(\n                **get_document_siblings_endpoint(document_id=target_id, space_id=temp_space)\n            )\n            assert resp.status_code == 200\n            payload = resp.json()['payload']\n    \n        with allure.step('Проверка корректности сиблингов'):\n            assert payload['prevSibling']['_id'] == child_ids[0]\n            assert payload['nextSibling']['_id'] == child_ids[2]\n            assert payload['parents'][0]['_id'] == parent_id\n            assert any(node['document']['_id'] == target_id for node in payload['tree'])\n    \n        with allure.step('Проверка структуры дерева'):\n            for node in payload['tree']:\n                assert 'document' in node, 'В узле дерева отсутствует поле document'\n    \n        with allure.step('Проверка наличия обязательных полей в document'):\n            required_fields = ['_id', 'title', 'kind', 'kindId']\n            for node in payload['tree']:\n                for field in required_fields:\n                    assert field in node['document'], f'В документе отсутствует поле {field}'\n    \n        with allure.step('Проверка сиблингов родительского документа — их не должно быть'):\n            resp = owner_client.post(\n                **get_document_siblings_endpoint(document_id=parent_id, space_id=temp_space)\n            )\n            assert resp.status_code == 200\n            payload = resp.json()['payload']\n>           assert payload.get('prevSibling') is None\nE           AssertionError: assert {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} is None\nE            +  where {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} = <built-in method get of dict object at 0x7f491fb6a1c0>('prevSibling')\nE            +    where <built-in method get of dict object at 0x7f491fb6a1c0> = {'parents': [], 'prevSibling': {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'tree': [{'document': {'_id': '685bed75a2b8f0d475365e41', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed75a2b8f0d475365e41', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685bed76a2b8f0d475365e56', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e56', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685bed76a2b8f0d475365e6e', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e6e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685bed77a2b8f0d475365e88', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed77a2b8f0d475365e88', 'lft': 5, 'rgt': 6}]}.get\n\ntests/test_backend/document/test_get_siblings.py:81: AssertionError","steps":[{"name":"Создание родительского документа","time":{"start":1750855029834,"stop":1750855030128,"duration":294},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Создание дочерних документов","time":{"start":1750855030128,"stop":1750855031291,"duration":1163},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Запрос сиблингов для среднего дочернего документа","time":{"start":1750855031291,"stop":1750855031587,"duration":296},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка корректности сиблингов","time":{"start":1750855031587,"stop":1750855031588,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка структуры дерева","time":{"start":1750855031588,"stop":1750855031588,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка наличия обязательных полей в document","time":{"start":1750855031588,"stop":1750855031588,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка сиблингов родительского документа — их не должно быть","time":{"start":1750855031588,"stop":1750855031821,"duration":233},"status":"failed","statusMessage":"AssertionError: assert {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} is None\n +  where {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...} = <built-in method get of dict object at 0x7f491fb6a1c0>('prevSibling')\n +    where <built-in method get of dict object at 0x7f491fb6a1c0> = {'parents': [], 'prevSibling': {'_id': '685bed6ca2b8f0d475365d03', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'tree': [{'document': {'_id': '685bed75a2b8f0d475365e41', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed75a2b8f0d475365e41', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685bed76a2b8f0d475365e56', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e56', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685bed76a2b8f0d475365e6e', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed76a2b8f0d475365e6e', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685bed77a2b8f0d475365e88', 'kind': 'Space', 'kindId': '685bed26a2b8f0d475364736', 'map': [], ...}, 'id': '685bed77a2b8f0d475365e88', 'lft': 5, 'rgt': 6}]}.get\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/document/test_get_siblings.py\", line 81, in test_get_document_siblings\n    assert payload.get('prevSibling') is None\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":7,"attachmentsCount":0,"hasContent":true},"afterStages":[{"name":"temp_space::0","time":{"start":1750855044639,"stop":1750855045294,"duration":655},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"labels":[{"name":"tag","value":"backend"},{"name":"parentSuite","value":"tests.test_backend.document"},{"name":"suite","value":"test_get_siblings"},{"name":"host","value":"pkrvmxyh4eaekms"},{"name":"thread","value":"2557-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.document.test_get_siblings"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"fixture_name","value":"'temp_space'"},{"name":"kind","value":"'Space'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":2,"broken":0,"skipped":0,"passed":1,"unknown":0,"total":3},"items":[{"uid":"a4de5dcd74c52bcc","reportUrl":"https://vaizcom.github.io/autotests/207//#testresult/a4de5dcd74c52bcc","status":"failed","statusDetails":"AssertionError: assert {'_id': '685be310a2b8f0d475360f20', 'kind': 'Space', 'kindId': '685be2c9a2b8f0d47535fb1f', 'map': [], ...} is None\n +  where {'_id': '685be310a2b8f0d475360f20', 'kind': 'Space', 'kindId': '685be2c9a2b8f0d47535fb1f', 'map': [], ...} = <built-in method get of dict object at 0x7feecc7e6cc0>('prevSibling')\n +    where <built-in method get of dict object at 0x7feecc7e6cc0> = {'parents': [], 'prevSibling': {'_id': '685be310a2b8f0d475360f20', 'kind': 'Space', 'kindId': '685be2c9a2b8f0d47535fb1f', 'map': [], ...}, 'tree': [{'document': {'_id': '685be319a2b8f0d4753610d6', 'kind': 'Space', 'kindId': '685be2c9a2b8f0d47535fb1f', 'map': [], ...}, 'id': '685be319a2b8f0d4753610d6', 'lft': 0, 'rgt': 7}, {'document': {'_id': '685be31aa2b8f0d4753610eb', 'kind': 'Space', 'kindId': '685be2c9a2b8f0d47535fb1f', 'map': [], ...}, 'id': '685be31aa2b8f0d4753610eb', 'lft': 1, 'rgt': 2}, {'document': {'_id': '685be31aa2b8f0d475361103', 'kind': 'Space', 'kindId': '685be2c9a2b8f0d47535fb1f', 'map': [], ...}, 'id': '685be31aa2b8f0d475361103', 'lft': 3, 'rgt': 4}, {'document': {'_id': '685be31ba2b8f0d47536111d', 'kind': 'Space', 'kindId': '685be2c9a2b8f0d47535fb1f', 'map': [], ...}, 'id': '685be31ba2b8f0d47536111d', 'lft': 5, 'rgt': 6}]}.get","time":{"start":1750852377812,"stop":1750852379687,"duration":1875}},{"uid":"73b61575716eaa0","reportUrl":"https://vaizcom.github.io/autotests/206//#testresult/73b61575716eaa0","status":"passed","time":{"start":1750773507271,"stop":1750773509210,"duration":1939}}]},"tags":["backend"]},"source":"3d983cf3f7eb77db.json","parameterValues":["'temp_space'","'Space'"]}