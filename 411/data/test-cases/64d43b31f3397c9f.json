{"uid":"64d43b31f3397c9f","name":"Проверка уменьшения счетчика сабтасок после удаления сабтасок в родительской задаче","fullName":"tests.test_backend.task_service.create_task.test_taskTable_total_subtask_counter#test_parent_task_total_subtask_count_decrease_after_subtask_deletion","historyId":"6e5453821c2c646b30b62b3f5cce55d8","time":{"start":1762270000324,"stop":1762270030271,"duration":29947},"description":"\n    Тест проверяет корректное уменьшение счетчика total сабтасок после удаления подзадач.\n    ","descriptionHtml":"<pre><code>Тест проверяет корректное уменьшение счетчика total сабтасок после удаления подзадач.\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: После удаления 9 сабтасок ожидали total=0, получили 1\nassert 1 == 0","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f8092a6cdd0>\nmain_space = '6866309d85fb8d104544a61e'\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f809271aa20>\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка уменьшения счетчика сабтасок после удаления сабтасок в родительской задаче\")\n    def test_parent_task_total_subtask_count_decrease_after_subtask_deletion(owner_client, main_space, create_task_in_main):\n        \"\"\"\n        Тест проверяет корректное уменьшение счетчика total сабтасок после удаления подзадач.\n        \"\"\"\n        client = owner_client\n        # Создаем родительскую задачу\n        parent_task = create_task_in_main(\"owner_client\", name=\"Parent task for decrease subtask total test\")\n        parent_task_id = parent_task[\"_id\"]\n        created_subtask_ids = []\n    \n        try:\n            with allure.step(\"Создаем рандомное количество сабтасок (от 1 до 10) для родительской задачи\"):\n                random_count = random.randint(1, 10)\n                for i in range(1, random_count + 1):\n                    subtask = create_task_in_main(\n                        \"owner_client\",\n                        parent_task=parent_task_id,\n                        name=f\"Subtask #{i} for decrease subtask total test\",\n                    )\n                    created_subtask_ids.append(subtask[\"_id\"])\n    \n            with allure.step(\"Проверяем, что total соответствует количеству созданных сабтасок\"):\n                total_after_creation = get_parent_task_subtask_count(client, main_space, parent_task_id)\n                assert total_after_creation == random_count, f\"Ожидалось total={random_count}, получили {total_after_creation}\"\n    \n            with allure.step(\"Удаляем сабтаски по одной и проверяем decrement total пока их кол-во не станет равным 0\"):\n                for index, subtask_id in enumerate(created_subtask_ids, 1):\n                    delete_task_with_retry(client, subtask_id, main_space)\n                    expected_total = random_count - index\n                    actual_total = get_parent_task_subtask_count(client, main_space, parent_task_id)\n>                   assert actual_total == expected_total, f\"После удаления {index} сабтасок ожидали total={expected_total}, получили {actual_total}\"\nE                   AssertionError: После удаления 9 сабтасок ожидали total=0, получили 1\nE                   assert 1 == 0\n\ntests/test_backend/task_service/create_task/test_taskTable_total_subtask_counter.py:106: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"delete_output_dir","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_client","time":{"start":1762269348434,"stop":1762269348763,"duration":329},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_space","time":{"start":1762269348763,"stop":1762269349493,"duration":730},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_project","time":{"start":1762269349493,"stop":1762269350075,"duration":582},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"owner_client","time":{"start":1762269350076,"stop":1762269350375,"duration":299},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_board","time":{"start":1762269353394,"stop":1762269353673,"duration":279},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"create_task_in_main","time":{"start":1762270000324,"stop":1762270000324,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Тест проверяет корректное уменьшение счетчика total сабтасок после удаления подзадач.\n    ","status":"failed","statusMessage":"AssertionError: После удаления 9 сабтасок ожидали total=0, получили 1\nassert 1 == 0","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f8092a6cdd0>\nmain_space = '6866309d85fb8d104544a61e'\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f809271aa20>\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка уменьшения счетчика сабтасок после удаления сабтасок в родительской задаче\")\n    def test_parent_task_total_subtask_count_decrease_after_subtask_deletion(owner_client, main_space, create_task_in_main):\n        \"\"\"\n        Тест проверяет корректное уменьшение счетчика total сабтасок после удаления подзадач.\n        \"\"\"\n        client = owner_client\n        # Создаем родительскую задачу\n        parent_task = create_task_in_main(\"owner_client\", name=\"Parent task for decrease subtask total test\")\n        parent_task_id = parent_task[\"_id\"]\n        created_subtask_ids = []\n    \n        try:\n            with allure.step(\"Создаем рандомное количество сабтасок (от 1 до 10) для родительской задачи\"):\n                random_count = random.randint(1, 10)\n                for i in range(1, random_count + 1):\n                    subtask = create_task_in_main(\n                        \"owner_client\",\n                        parent_task=parent_task_id,\n                        name=f\"Subtask #{i} for decrease subtask total test\",\n                    )\n                    created_subtask_ids.append(subtask[\"_id\"])\n    \n            with allure.step(\"Проверяем, что total соответствует количеству созданных сабтасок\"):\n                total_after_creation = get_parent_task_subtask_count(client, main_space, parent_task_id)\n                assert total_after_creation == random_count, f\"Ожидалось total={random_count}, получили {total_after_creation}\"\n    \n            with allure.step(\"Удаляем сабтаски по одной и проверяем decrement total пока их кол-во не станет равным 0\"):\n                for index, subtask_id in enumerate(created_subtask_ids, 1):\n                    delete_task_with_retry(client, subtask_id, main_space)\n                    expected_total = random_count - index\n                    actual_total = get_parent_task_subtask_count(client, main_space, parent_task_id)\n>                   assert actual_total == expected_total, f\"После удаления {index} сабтасок ожидали total={expected_total}, получили {actual_total}\"\nE                   AssertionError: После удаления 9 сабтасок ожидали total=0, получили 1\nE                   assert 1 == 0\n\ntests/test_backend/task_service/create_task/test_taskTable_total_subtask_counter.py:106: AssertionError","steps":[{"name":"Создаем рандомное количество сабтасок (от 1 до 10) для родительской задачи","time":{"start":1762270002064,"stop":1762270014903,"duration":12839},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверяем, что total соответствует количеству созданных сабтасок","time":{"start":1762270014904,"stop":1762270015234,"duration":330},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Удаляем сабтаски по одной и проверяем decrement total пока их кол-во не станет равным 0","time":{"start":1762270015234,"stop":1762270022467,"duration":7233},"status":"failed","statusMessage":"AssertionError: После удаления 9 сабтасок ожидали total=0, получили 1\nassert 1 == 0\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/create_task/test_taskTable_total_subtask_counter.py\", line 106, in test_parent_task_total_subtask_count_decrease_after_subtask_deletion\n    assert actual_total == expected_total, f\"После удаления {index} сабтасок ожидали total={expected_total}, получили {actual_total}\"\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Удаляем сабтаски и родительскую задачу принудительно (на случай если тесты упадут)","time":{"start":1762270022467,"stop":1762270030271,"duration":7804},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[{"uid":"6b8fe3a36e15fba0","name":"stdout","source":"6b8fe3a36e15fba0.txt","type":"text/plain","size":2428}],"parameters":[],"stepsCount":4,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"create_task"},{"name":"tag","value":"backend"},{"name":"suite","value":"test_taskTable_total_subtask_counter"},{"name":"host","value":"runnervmf2e7y"},{"name":"thread","value":"2569-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.task_service.create_task.test_taskTable_total_subtask_counter"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":3,"unknown":0,"total":4},"items":[{"uid":"ffe7662f7a4512fb","reportUrl":"https://vaizcom.github.io/autotests/410/#testresult/ffe7662f7a4512fb","status":"passed","time":{"start":1762269758298,"stop":1762269787994,"duration":29696}},{"uid":"3b32d6b7a1249361","reportUrl":"https://vaizcom.github.io/autotests/409/#testresult/3b32d6b7a1249361","status":"passed","time":{"start":1762269032168,"stop":1762269045277,"duration":13109}},{"uid":"43ea48b0884e6c62","reportUrl":"https://vaizcom.github.io/autotests/408/#testresult/43ea48b0884e6c62","status":"passed","time":{"start":1762245480876,"stop":1762245485741,"duration":4865}}]},"tags":["backend"]},"source":"64d43b31f3397c9f.json","parameterValues":[]}