{"uid":"d58f76d40f71be84","name":"Доступ к таскам спейса под ролью Owner (HTTP 200)","fullName":"tests.test_backend.task_service.get_tasks.access_get_tasks.test_get_tasks_space_all#test_get_tasks_by_role_in_second_space","historyId":"d2d681066373712c22bf02239c8275cd","time":{"start":1763996459648,"stop":1763996499441,"duration":39793},"description":"\n    Проверка доступа ко всем таскам в спейсе для всех ролей:\n    - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\n    TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n    (сейчас указан спейс в котором нет архивных тасок)\n    ","descriptionHtml":"<pre><code>Проверка доступа ко всем таскам в спейсе для всех ролей:\n- роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\nTODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n(сейчас указан спейс в котором нет архивных тасок)\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452","statusTrace":"request = <FixtureRequest for <Function test_get_tasks_by_role_in_second_space[owner]>>\nclient_fixture = 'owner_client', expected_status = 200\nsecond_space = '691adf9e4bfde6405d9feb3a'\nsecond_project = '691adf9f4bfde6405d9feb4a'\nmain_project = '686672af85fb8d104544e798'\n\n    @allure.title(\"GetTasks: Проверка доступа к задачам спейса для всех ролей (без фильтраций)\")\n    @pytest.mark.parametrize(\n        'client_fixture, expected_status',\n        [\n            ('owner_client', 200),\n            ('manager_client', 200),\n            ('member_client', 200),\n            ('guest_client', 200)\n        ],\n        ids=['owner', 'manager', 'member', 'guest'],\n    )\n    def test_get_tasks_by_role_in_second_space(request, client_fixture, expected_status, second_space, second_project, main_project):\n        \"\"\"\n        Проверка доступа ко всем таскам в спейсе для всех ролей:\n        - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n    \n        TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n        (сейчас указан спейс в котором нет архивных тасок)\n        \"\"\"\n        client = request.getfixturevalue(client_fixture)\n        role_name = client_fixture.replace('_client', '').capitalize()\n        allure.dynamic.title(f\"Доступ к таскам спейса под ролью {role_name} (HTTP {expected_status})\")\n    \n        with allure.step(f\"{client_fixture}: вызвать GetTasks без фильтров\"):\n            resp = client.post(**get_tasks_endpoint(space_id=second_space))\n    \n        with allure.step(f\"Проверить HTTP {expected_status}\"):\n            assert resp.status_code == expected_status\n    \n        with allure.step(\"Проверить payload\"):\n            payload = resp.json().get(\"payload\", {})\n            assert \"tasks\" in payload and isinstance(payload[\"tasks\"], list)\n            tasks = payload[\"tasks\"]\n    \n        if not tasks:\n            pytest.skip(\"Список задач пуст — нечего валидировать\")\n    \n        # Жёсткая проверка: каждая задача должна принадлежать только second_project\n        with allure.step(\"Проверить отсутствие задач из другого спейса)\"):\n            for task in tasks[:20]:\n                assert \"project\" in task, f\"У задачи {task.get('_id', 'unknown')} отсутствует поле project\"\n>               assert task.get(\"project\") == second_project, (\n                    f\"Задача {task.get('_id', 'unknown')} принадлежит другому проекту: {task.get('project')}, \"\n                    f\"ожидался {second_project}\"\n                    )\nE               AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nE               assert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\nE                 \nE                 - 691adf9f4bfde6405d9feb4a\nE                 + 63286261a466b6becd9d6452\n\ntests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py:49: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"description":"\n    Проверка доступа ко всем таскам в спейсе для всех ролей:\n    - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n\n    TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n    (сейчас указан спейс в котором нет архивных тасок)\n    ","status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452","statusTrace":"request = <FixtureRequest for <Function test_get_tasks_by_role_in_second_space[owner]>>\nclient_fixture = 'owner_client', expected_status = 200\nsecond_space = '691adf9e4bfde6405d9feb3a'\nsecond_project = '691adf9f4bfde6405d9feb4a'\nmain_project = '686672af85fb8d104544e798'\n\n    @allure.title(\"GetTasks: Проверка доступа к задачам спейса для всех ролей (без фильтраций)\")\n    @pytest.mark.parametrize(\n        'client_fixture, expected_status',\n        [\n            ('owner_client', 200),\n            ('manager_client', 200),\n            ('member_client', 200),\n            ('guest_client', 200)\n        ],\n        ids=['owner', 'manager', 'member', 'guest'],\n    )\n    def test_get_tasks_by_role_in_second_space(request, client_fixture, expected_status, second_space, second_project, main_project):\n        \"\"\"\n        Проверка доступа ко всем таскам в спейсе для всех ролей:\n        - роли с доступом: HTTP 200 и все задачи принадлежат указанному спейсу;\n    \n        TODO: после исправления бага добавить проверку, что заархивированные задачи не попадают в выборку\n        (сейчас указан спейс в котором нет архивных тасок)\n        \"\"\"\n        client = request.getfixturevalue(client_fixture)\n        role_name = client_fixture.replace('_client', '').capitalize()\n        allure.dynamic.title(f\"Доступ к таскам спейса под ролью {role_name} (HTTP {expected_status})\")\n    \n        with allure.step(f\"{client_fixture}: вызвать GetTasks без фильтров\"):\n            resp = client.post(**get_tasks_endpoint(space_id=second_space))\n    \n        with allure.step(f\"Проверить HTTP {expected_status}\"):\n            assert resp.status_code == expected_status\n    \n        with allure.step(\"Проверить payload\"):\n            payload = resp.json().get(\"payload\", {})\n            assert \"tasks\" in payload and isinstance(payload[\"tasks\"], list)\n            tasks = payload[\"tasks\"]\n    \n        if not tasks:\n            pytest.skip(\"Список задач пуст — нечего валидировать\")\n    \n        # Жёсткая проверка: каждая задача должна принадлежать только second_project\n        with allure.step(\"Проверить отсутствие задач из другого спейса)\"):\n            for task in tasks[:20]:\n                assert \"project\" in task, f\"У задачи {task.get('_id', 'unknown')} отсутствует поле project\"\n>               assert task.get(\"project\") == second_project, (\n                    f\"Задача {task.get('_id', 'unknown')} принадлежит другому проекту: {task.get('project')}, \"\n                    f\"ожидался {second_project}\"\n                    )\nE               AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nE               assert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\nE                 \nE                 - 691adf9f4bfde6405d9feb4a\nE                 + 63286261a466b6becd9d6452\n\ntests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py:49: AssertionError","steps":[{"name":"owner_client: вызвать GetTasks без фильтров","time":{"start":1763996459648,"stop":1763996498864,"duration":39216},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить HTTP 200","time":{"start":1763996498864,"stop":1763996498864,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить payload","time":{"start":1763996498864,"stop":1763996499441,"duration":577},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверить отсутствие задач из другого спейса)","time":{"start":1763996499441,"stop":1763996499441,"duration":0},"status":"failed","statusMessage":"AssertionError: Задача 632880f6aa99c1540a2738b6 принадлежит другому проекту: 63286261a466b6becd9d6452, ожидался 691adf9f4bfde6405d9feb4a\nassert '63286261a466b6becd9d6452' == '691adf9f4bfde6405d9feb4a'\n  \n  - 691adf9f4bfde6405d9feb4a\n  + 63286261a466b6becd9d6452\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/get_tasks/access_get_tasks/test_get_tasks_space_all.py\", line 49, in test_get_tasks_by_role_in_second_space\n    assert task.get(\"project\") == second_project, (\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":4,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"tag","value":"backend"},{"name":"parentSuite","value":"tests.test_backend.task_service.get_tasks.access_get_tasks"},{"name":"suite","value":"test_get_tasks_space_all"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"2653-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.task_service.get_tasks.access_get_tasks.test_get_tasks_space_all"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"client_fixture","value":"'owner_client'"},{"name":"expected_status","value":"200"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":19,"unknown":0,"total":20},"items":[{"uid":"14670efbc8c297c6","reportUrl":"https://vaizcom.github.io/autotests/470/#testresult/14670efbc8c297c6","status":"passed","time":{"start":1763995227195,"stop":1763995227473,"duration":278}},{"uid":"97698bf2335c9e21","reportUrl":"https://vaizcom.github.io/autotests/469/#testresult/97698bf2335c9e21","status":"passed","time":{"start":1763993480264,"stop":1763993480535,"duration":271}},{"uid":"c19da2e72672b434","reportUrl":"https://vaizcom.github.io/autotests/468/#testresult/c19da2e72672b434","status":"passed","time":{"start":1763734845189,"stop":1763734845475,"duration":286}},{"uid":"8f349cb09deac82a","reportUrl":"https://vaizcom.github.io/autotests/467/#testresult/8f349cb09deac82a","status":"passed","time":{"start":1763733025788,"stop":1763733026067,"duration":279}},{"uid":"c95362c1b7f354a0","reportUrl":"https://vaizcom.github.io/autotests/466/#testresult/c95362c1b7f354a0","status":"passed","time":{"start":1763726679185,"stop":1763726679424,"duration":239}},{"uid":"1d75085b1151757e","reportUrl":"https://vaizcom.github.io/autotests/465/#testresult/1d75085b1151757e","status":"passed","time":{"start":1763720219842,"stop":1763720220071,"duration":229}},{"uid":"6db94c0b8c1b8f84","reportUrl":"https://vaizcom.github.io/autotests/464/#testresult/6db94c0b8c1b8f84","status":"passed","time":{"start":1763715529883,"stop":1763715530093,"duration":210}},{"uid":"9da27ab03502caea","reportUrl":"https://vaizcom.github.io/autotests/463/#testresult/9da27ab03502caea","status":"passed","time":{"start":1763714949639,"stop":1763714950232,"duration":593}},{"uid":"39662e5f5c1b1f49","reportUrl":"https://vaizcom.github.io/autotests/462/#testresult/39662e5f5c1b1f49","status":"passed","time":{"start":1763711383985,"stop":1763711384205,"duration":220}},{"uid":"31fba4fe7d3d92de","reportUrl":"https://vaizcom.github.io/autotests/461/#testresult/31fba4fe7d3d92de","status":"passed","time":{"start":1763710406161,"stop":1763710406427,"duration":266}},{"uid":"a65e6230702ca014","reportUrl":"https://vaizcom.github.io/autotests/460/#testresult/a65e6230702ca014","status":"passed","time":{"start":1763651932949,"stop":1763651933175,"duration":226}},{"uid":"c2507b49291aaf16","reportUrl":"https://vaizcom.github.io/autotests/459/#testresult/c2507b49291aaf16","status":"passed","time":{"start":1763650072644,"stop":1763650072905,"duration":261}},{"uid":"17e0f897e9393333","reportUrl":"https://vaizcom.github.io/autotests/458/#testresult/17e0f897e9393333","status":"passed","time":{"start":1763631445693,"stop":1763631445886,"duration":193}},{"uid":"38d3179d7b10ae43","reportUrl":"https://vaizcom.github.io/autotests/457/#testresult/38d3179d7b10ae43","status":"passed","time":{"start":1763628802395,"stop":1763628802785,"duration":390}},{"uid":"a70b7433fafa0cc1","reportUrl":"https://vaizcom.github.io/autotests/456/#testresult/a70b7433fafa0cc1","status":"passed","time":{"start":1763559939684,"stop":1763559939967,"duration":283}},{"uid":"45dc2b55c1c3c2d5","reportUrl":"https://vaizcom.github.io/autotests/455/#testresult/45dc2b55c1c3c2d5","status":"passed","time":{"start":1763542887289,"stop":1763542887893,"duration":604}},{"uid":"b9a1c461c5801711","reportUrl":"https://vaizcom.github.io/autotests/454/#testresult/b9a1c461c5801711","status":"passed","time":{"start":1763540614647,"stop":1763540615099,"duration":452}},{"uid":"a2496ed1a14a7493","reportUrl":"https://vaizcom.github.io/autotests/453/#testresult/a2496ed1a14a7493","status":"passed","time":{"start":1763478067381,"stop":1763478067640,"duration":259}},{"uid":"99a4031c793472f0","reportUrl":"https://vaizcom.github.io/autotests/452/#testresult/99a4031c793472f0","status":"passed","time":{"start":1763476249005,"stop":1763476249278,"duration":273}}]},"tags":["backend"]},"source":"d58f76d40f71be84.json","parameterValues":["'owner_client'","200"]}