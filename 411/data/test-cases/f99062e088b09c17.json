{"uid":"f99062e088b09c17","name":"test_archive_all_documents[project_docs]","fullName":"tests.test_backend.document.test_archive_all_docs#test_archive_all_documents","historyId":"81a733a0986e34e9cc5f1634f12b9c7a","time":{"start":1762269706772,"stop":1762269715206,"duration":8434},"description":"\n    Проверяем удаление всех документов в пространстве и проекте.\n    ","descriptionHtml":"<pre><code>Проверяем удаление всех документов в пространстве и проекте.\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: Не удалось архивировать документ 690a1a0ae4567e7b3a4b00e7: статус 400\nassert 400 == 200\n +  where 400 = <Response [400]>.status_code","statusTrace":"request = <FixtureRequest for <Function test_archive_all_documents[project_docs]>>\nowner_client = <tests.core.client.APIClient object at 0x7f8092a6cdd0>\nkind = 'Project', container_fixture = 'main_project'\nmain_space = '6866309d85fb8d104544a61e'\nexcluded_documents = {'68a5b3f4a136528e28f58d65', '68a81156e503a7ab645236c1'}\n\n    @pytest.mark.parametrize(\n        'kind, container_fixture',\n        [\n            ('Space', 'main_space'),\n            ('Project', 'main_project'),\n        ],\n        ids=['space_docs', 'project_docs'],\n    )\n    def test_archive_all_documents(request, owner_client, kind, container_fixture, main_space, excluded_documents):\n        \"\"\"\n        Проверяем удаление всех документов в пространстве и проекте.\n        \"\"\"\n        with allure.step(f'Подготовка к удалению документов в {kind}'):\n            container_id = request.getfixturevalue(container_fixture)\n    \n        with allure.step(f'Получение списка документов в {kind}'):\n            docs_resp = owner_client.post(**get_documents_endpoint(space_id=main_space, kind=kind, kind_id=container_id))\n            assert docs_resp.status_code == 200, 'Не удалось получить список документов'\n            # Получаем список ID документов\n            doc_ids = [doc['_id'] for doc in docs_resp.json()['payload']['documents']]\n    \n        with allure.step(f'Удаление всех документов в {kind}, кроме исключений'):\n            for doc_id in doc_ids:\n                if doc_id in excluded_documents:\n                    allure.step(f'Пропуск документа {doc_id}, т.к. он в списке исключений.')\n                    continue\n                archive_resp = owner_client.post(**archive_document_endpoint(document_id=doc_id, space_id=main_space))\n>               assert archive_resp.status_code == 200, (\n                    f'Не удалось архивировать документ {doc_id}: ' f'статус {archive_resp.status_code}'\n                )\nE               AssertionError: Не удалось архивировать документ 690a1a0ae4567e7b3a4b00e7: статус 400\nE               assert 400 == 200\nE                +  where 400 = <Response [400]>.status_code\n\ntests/test_backend/document/test_archive_all_docs.py:46: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"delete_output_dir","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_client","time":{"start":1762269348434,"stop":1762269348763,"duration":329},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_space","time":{"start":1762269348763,"stop":1762269349493,"duration":730},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_project","time":{"start":1762269349493,"stop":1762269350075,"duration":582},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"owner_client","time":{"start":1762269350076,"stop":1762269350375,"duration":299},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_project_doc","time":{"start":1762269701508,"stop":1762269701508,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_space_doc","time":{"start":1762269701508,"stop":1762269701508,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"excluded_documents","time":{"start":1762269703863,"stop":1762269703863,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Проверяем удаление всех документов в пространстве и проекте.\n    ","status":"failed","statusMessage":"AssertionError: Не удалось архивировать документ 690a1a0ae4567e7b3a4b00e7: статус 400\nassert 400 == 200\n +  where 400 = <Response [400]>.status_code","statusTrace":"request = <FixtureRequest for <Function test_archive_all_documents[project_docs]>>\nowner_client = <tests.core.client.APIClient object at 0x7f8092a6cdd0>\nkind = 'Project', container_fixture = 'main_project'\nmain_space = '6866309d85fb8d104544a61e'\nexcluded_documents = {'68a5b3f4a136528e28f58d65', '68a81156e503a7ab645236c1'}\n\n    @pytest.mark.parametrize(\n        'kind, container_fixture',\n        [\n            ('Space', 'main_space'),\n            ('Project', 'main_project'),\n        ],\n        ids=['space_docs', 'project_docs'],\n    )\n    def test_archive_all_documents(request, owner_client, kind, container_fixture, main_space, excluded_documents):\n        \"\"\"\n        Проверяем удаление всех документов в пространстве и проекте.\n        \"\"\"\n        with allure.step(f'Подготовка к удалению документов в {kind}'):\n            container_id = request.getfixturevalue(container_fixture)\n    \n        with allure.step(f'Получение списка документов в {kind}'):\n            docs_resp = owner_client.post(**get_documents_endpoint(space_id=main_space, kind=kind, kind_id=container_id))\n            assert docs_resp.status_code == 200, 'Не удалось получить список документов'\n            # Получаем список ID документов\n            doc_ids = [doc['_id'] for doc in docs_resp.json()['payload']['documents']]\n    \n        with allure.step(f'Удаление всех документов в {kind}, кроме исключений'):\n            for doc_id in doc_ids:\n                if doc_id in excluded_documents:\n                    allure.step(f'Пропуск документа {doc_id}, т.к. он в списке исключений.')\n                    continue\n                archive_resp = owner_client.post(**archive_document_endpoint(document_id=doc_id, space_id=main_space))\n>               assert archive_resp.status_code == 200, (\n                    f'Не удалось архивировать документ {doc_id}: ' f'статус {archive_resp.status_code}'\n                )\nE               AssertionError: Не удалось архивировать документ 690a1a0ae4567e7b3a4b00e7: статус 400\nE               assert 400 == 200\nE                +  where 400 = <Response [400]>.status_code\n\ntests/test_backend/document/test_archive_all_docs.py:46: AssertionError","steps":[{"name":"Подготовка к удалению документов в Project","time":{"start":1762269706772,"stop":1762269706772,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Получение списка документов в Project","time":{"start":1762269706772,"stop":1762269707087,"duration":315},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Удаление всех документов в Project, кроме исключений","time":{"start":1762269707087,"stop":1762269715205,"duration":8118},"status":"failed","statusMessage":"AssertionError: Не удалось архивировать документ 690a1a0ae4567e7b3a4b00e7: статус 400\nassert 400 == 200\n +  where 400 = <Response [400]>.status_code\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/document/test_archive_all_docs.py\", line 46, in test_archive_all_documents\n    assert archive_resp.status_code == 200, (\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":3,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"tag","value":"backend"},{"name":"parentSuite","value":"tests.test_backend.document"},{"name":"suite","value":"test_archive_all_docs"},{"name":"host","value":"runnervmf2e7y"},{"name":"thread","value":"2569-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.document.test_archive_all_docs"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"container_fixture","value":"'main_project'"},{"name":"kind","value":"'Project'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":3,"unknown":0,"total":4},"items":[{"uid":"69dadb639b47d7c6","reportUrl":"https://vaizcom.github.io/autotests/410/#testresult/69dadb639b47d7c6","status":"passed","time":{"start":1762269484829,"stop":1762269485516,"duration":687}},{"uid":"8df9a3f05ad8b58f","reportUrl":"https://vaizcom.github.io/autotests/409/#testresult/8df9a3f05ad8b58f","status":"passed","time":{"start":1762268850738,"stop":1762268850943,"duration":205}},{"uid":"cb58c2d91769b8ad","reportUrl":"https://vaizcom.github.io/autotests/408/#testresult/cb58c2d91769b8ad","status":"passed","time":{"start":1762245240429,"stop":1762245240779,"duration":350}}]},"tags":["backend"]},"source":"f99062e088b09c17.json","parameterValues":["'main_project'","'Project'"]}