{"uid":"bd8e5064bbe46ec0","name":"Проверка уменьшения счетчика задач milestone после удаления задач","fullName":"tests.test_backend.task_service.create_task.test_milestone_tasks_total_and_completed#test_milestone_total_task_count_decrease_after_task_deletion","historyId":"3c4cdfa8fab7636eea4431cab8ab2905","time":{"start":1762269952083,"stop":1762269965933,"duration":13850},"description":"\n    Тест проверяет корректное уменьшение счетчика total после удаления задач и ожидает total=0 в конце.\n    ","descriptionHtml":"<pre><code>Тест проверяет корректное уменьшение счетчика total после удаления задач и ожидает total=0 в конце.\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: После удаления 3 задач ожидали total=0, получили 1\nassert 1 == 0","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f8092a6cdd0>\nmain_space = '6866309d85fb8d104544a61e'\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f80928ec720>\nmain_board = '6866731185fb8d104544e826'\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка уменьшения счетчика задач milestone после удаления задач\")\n    def test_milestone_total_task_count_decrease_after_task_deletion(owner_client, main_space, create_task_in_main, main_board):\n        \"\"\"\n        Тест проверяет корректное уменьшение счетчика total после удаления задач и ожидает total=0 в конце.\n        \"\"\"\n        milestone_name = \"Milestone total task count\"\n        client = owner_client\n        milestone_id = get_named_milestone_id(client, main_space, main_board, milestone_name)\n        created_task_ids = []\n    \n        try:\n            with allure.step(\"Получаем начальное значение total у milestone\"):\n                initial_total = get_milestone_total(client, main_space, milestone_id)\n    \n            if initial_total != 0:\n                with allure.step(\"Очищаем milestone от задач, проверяем что total = 0\"):\n                    clear_milestone_tasks(client, main_space, milestone_id)\n                assert initial_total == 0\n    \n            with allure.step(\"Создаём рандомное кол-во задач  (от 1 до 10) с этим milestone\"):\n                random_count = random.randint(1, 10)\n                for i in range(1, random_count + 1):\n                    task = create_task_in_main(\n                        \"owner_client\",\n                        milestones=[milestone_id],\n                        name=f\"Task #{i} for milestone decrease test\",\n                    )\n                    created_task_ids.append(task[\"_id\"])\n    \n            with allure.step(\"Проверяем, что total соответствует количеству созданных задач\"):\n                total_after_creation = get_milestone_total(client, main_space, milestone_id)\n                assert total_after_creation == random_count, f\"Ожидалось total={random_count}, получили {total_after_creation}\"\n    \n            with allure.step(\"Удаляем задачи по одной и проверяем decrement total\"):\n                for index, task_id in enumerate(created_task_ids, 1): # 1 задаёт начальное значение счётчика индекса(по умолчанию=0).\n                    delete_task_with_retry(client, task_id, main_space)\n                    expected_total = random_count - index\n                    actual_total = get_milestone_total(client, main_space, milestone_id)\n>                   assert actual_total == expected_total, f\"После удаления {index} задач ожидали total={expected_total}, получили {actual_total}\"\nE                   AssertionError: После удаления 3 задач ожидали total=0, получили 1\nE                   assert 1 == 0\n\ntests/test_backend/task_service/create_task/test_milestone_tasks_total_and_completed.py:130: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"delete_output_dir","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1762269348434,"stop":1762269348434,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_client","time":{"start":1762269348434,"stop":1762269348763,"duration":329},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_space","time":{"start":1762269348763,"stop":1762269349493,"duration":730},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_project","time":{"start":1762269349493,"stop":1762269350075,"duration":582},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"owner_client","time":{"start":1762269350076,"stop":1762269350375,"duration":299},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_board","time":{"start":1762269353394,"stop":1762269353673,"duration":279},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"create_task_in_main","time":{"start":1762269952083,"stop":1762269952083,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Тест проверяет корректное уменьшение счетчика total после удаления задач и ожидает total=0 в конце.\n    ","status":"failed","statusMessage":"AssertionError: После удаления 3 задач ожидали total=0, получили 1\nassert 1 == 0","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f8092a6cdd0>\nmain_space = '6866309d85fb8d104544a61e'\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f80928ec720>\nmain_board = '6866731185fb8d104544e826'\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка уменьшения счетчика задач milestone после удаления задач\")\n    def test_milestone_total_task_count_decrease_after_task_deletion(owner_client, main_space, create_task_in_main, main_board):\n        \"\"\"\n        Тест проверяет корректное уменьшение счетчика total после удаления задач и ожидает total=0 в конце.\n        \"\"\"\n        milestone_name = \"Milestone total task count\"\n        client = owner_client\n        milestone_id = get_named_milestone_id(client, main_space, main_board, milestone_name)\n        created_task_ids = []\n    \n        try:\n            with allure.step(\"Получаем начальное значение total у milestone\"):\n                initial_total = get_milestone_total(client, main_space, milestone_id)\n    \n            if initial_total != 0:\n                with allure.step(\"Очищаем milestone от задач, проверяем что total = 0\"):\n                    clear_milestone_tasks(client, main_space, milestone_id)\n                assert initial_total == 0\n    \n            with allure.step(\"Создаём рандомное кол-во задач  (от 1 до 10) с этим milestone\"):\n                random_count = random.randint(1, 10)\n                for i in range(1, random_count + 1):\n                    task = create_task_in_main(\n                        \"owner_client\",\n                        milestones=[milestone_id],\n                        name=f\"Task #{i} for milestone decrease test\",\n                    )\n                    created_task_ids.append(task[\"_id\"])\n    \n            with allure.step(\"Проверяем, что total соответствует количеству созданных задач\"):\n                total_after_creation = get_milestone_total(client, main_space, milestone_id)\n                assert total_after_creation == random_count, f\"Ожидалось total={random_count}, получили {total_after_creation}\"\n    \n            with allure.step(\"Удаляем задачи по одной и проверяем decrement total\"):\n                for index, task_id in enumerate(created_task_ids, 1): # 1 задаёт начальное значение счётчика индекса(по умолчанию=0).\n                    delete_task_with_retry(client, task_id, main_space)\n                    expected_total = random_count - index\n                    actual_total = get_milestone_total(client, main_space, milestone_id)\n>                   assert actual_total == expected_total, f\"После удаления {index} задач ожидали total={expected_total}, получили {actual_total}\"\nE                   AssertionError: После удаления 3 задач ожидали total=0, получили 1\nE                   assert 1 == 0\n\ntests/test_backend/task_service/create_task/test_milestone_tasks_total_and_completed.py:130: AssertionError","steps":[{"name":"Получаем начальное значение total у milestone","time":{"start":1762269952598,"stop":1762269952868,"duration":270},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Создаём рандомное кол-во задач  (от 1 до 10) с этим milestone","time":{"start":1762269952868,"stop":1762269959021,"duration":6153},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверяем, что total соответствует количеству созданных задач","time":{"start":1762269959021,"stop":1762269959424,"duration":403},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Удаляем задачи по одной и проверяем decrement total","time":{"start":1762269959424,"stop":1762269963834,"duration":4410},"status":"failed","statusMessage":"AssertionError: После удаления 3 задач ожидали total=0, получили 1\nassert 1 == 0\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/create_task/test_milestone_tasks_total_and_completed.py\", line 130, in test_milestone_total_task_count_decrease_after_task_deletion\n    assert actual_total == expected_total, f\"После удаления {index} задач ожидали total={expected_total}, получили {actual_total}\"\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Финальная очистка созданных задач","time":{"start":1762269963834,"stop":1762269965933,"duration":2099},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[{"uid":"32361f0d9aef3a96","name":"stdout","source":"32361f0d9aef3a96.txt","type":"text/plain","size":934}],"parameters":[],"stepsCount":5,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"create_task"},{"name":"tag","value":"backend"},{"name":"suite","value":"test_milestone_tasks_total_and_completed"},{"name":"host","value":"runnervmf2e7y"},{"name":"thread","value":"2569-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.task_service.create_task.test_milestone_tasks_total_and_completed"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":3,"unknown":0,"total":4},"items":[{"uid":"1ee62f700c9e5eb0","reportUrl":"https://vaizcom.github.io/autotests/410/#testresult/1ee62f700c9e5eb0","status":"passed","time":{"start":1762269700081,"stop":1762269707471,"duration":7390}},{"uid":"4765ed883b5a70d0","reportUrl":"https://vaizcom.github.io/autotests/409/#testresult/4765ed883b5a70d0","status":"passed","time":{"start":1762268992321,"stop":1762269004889,"duration":12568}},{"uid":"52523f4be0e5da2","reportUrl":"https://vaizcom.github.io/autotests/408/#testresult/52523f4be0e5da2","status":"passed","time":{"start":1762245428445,"stop":1762245440709,"duration":12264}}]},"tags":["backend"]},"source":"bd8e5064bbe46ec0.json","parameterValues":[]}