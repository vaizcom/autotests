{"uid":"97720426a77858fe","name":"Проверка счетчика сабтасок в taskTable в родительской задаче","fullName":"tests.test_backend.task_service.create_task.test_taskTable_total_subtask_counter#test_parent_task_total_subtask_count_increases_after_subtask_creation","historyId":"49c5d5e85a1d9c125c627152dd4706b1","time":{"start":1765881302758,"stop":1765881315907,"duration":13149},"description":"\n    Тест проверяет увеличение счетчика total сабтасок у родительской задачи после добавления сабтасок.\n    ","descriptionHtml":"<pre><code>Тест проверяет увеличение счетчика total сабтасок у родительской задачи после добавления сабтасок.\n</code></pre>\n","status":"broken","statusMessage":"requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f0b048a7d10>\nmain_space = '6866309d85fb8d104544a61e'\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f0b046beac0>\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка счетчика сабтасок в taskTable в родительской задаче\")\n    def test_parent_task_total_subtask_count_increases_after_subtask_creation(owner_client, main_space,create_task_in_main):\n        \"\"\"\n        Тест проверяет увеличение счетчика total сабтасок у родительской задачи после добавления сабтасок.\n        \"\"\"\n        client = owner_client\n        # Создадим родительскую задачу без сабтасок\n        parent_task = create_task_in_main(\"owner_client\", name=\"Parent task for total subtask count test\")\n        parent_task_id = parent_task[\"_id\"]\n        created_subtask_ids = []\n    \n        try:\n            with allure.step(\"Получаем начальное значение total у родительской задачи\"):\n                initial_total = get_parent_task_subtask_count(client, main_space, parent_task_id)\n                assert initial_total == 0\n    \n            with allure.step(\"Создаем первую сабтаску с указанием родительской задачи\"):\n                subtask1 = create_task_in_main(\n                    \"owner_client\",\n                    parent_task=parent_task_id,\n                    name=\"Subtask 1 for parent task total count test\",\n                )\n                created_subtask_ids.append(subtask1[\"_id\"])\n    \n            with allure.step(\"Проверяем, что total увеличился на 1\"):\n                total_after_first = get_parent_task_subtask_count(client, main_space, parent_task_id)\n                assert total_after_first == initial_total + 1, f\"Ожидался total={initial_total + 1}, получили {total_after_first}\"\n    \n            with allure.step(\"Создаем последовательно рандомное количество сабтасок (от 1 до 10) и проверяем total\"):\n                random_count = random.randint(1, 10)\n                for i in range(1, random_count + 1):\n>                   subtask = create_task_in_main(\n                        \"owner_client\",\n                        parent_task=parent_task_id,\n                        name=f\"Random subtask #{i} for parent task total count test\",\n                    )\n\ntests/test_backend/task_service/create_task/test_taskTable_total_subtask_counter.py:51: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/test_backend/task_service/conftest.py:63: in _create_task\n    response.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400]>\n\n    def raise_for_status(self):\n        \"\"\"Raises :class:`HTTPError`, if one occurred.\"\"\"\n    \n        http_error_msg = \"\"\n        if isinstance(self.reason, bytes):\n            # We attempt to decode utf-8 first because some servers\n            # choose to localize their reason strings. If the string\n            # isn't utf-8, we fall back to iso-8859-1 for all other\n            # encodings. (See PR #3538)\n            try:\n                reason = self.reason.decode(\"utf-8\")\n            except UnicodeDecodeError:\n                reason = self.reason.decode(\"iso-8859-1\")\n        else:\n            reason = self.reason\n    \n        if 400 <= self.status_code < 500:\n            http_error_msg = (\n                f\"{self.status_code} Client Error: {reason} for url: {self.url}\"\n            )\n    \n        elif 500 <= self.status_code < 600:\n            http_error_msg = (\n                f\"{self.status_code} Server Error: {reason} for url: {self.url}\"\n            )\n    \n        if http_error_msg:\n>           raise HTTPError(http_error_msg, response=self)\nE           requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask\n\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/requests/models.py:1024: HTTPError","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"pytestconfig","time":{"start":1765880720314,"stop":1765880720314,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1765880720314,"stop":1765880720314,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"owner_client","time":{"start":1765880720314,"stop":1765880720793,"duration":479},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1765880720314,"stop":1765880720314,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1765880720314,"stop":1765880720314,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_client","time":{"start":1765880724558,"stop":1765880724860,"duration":302},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_space","time":{"start":1765880724860,"stop":1765880725415,"duration":555},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_project","time":{"start":1765880725415,"stop":1765880725849,"duration":434},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_board","time":{"start":1765880730526,"stop":1765880730794,"duration":268},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"create_task_in_main","time":{"start":1765881302758,"stop":1765881302758,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Тест проверяет увеличение счетчика total сабтасок у родительской задачи после добавления сабтасок.\n    ","status":"broken","statusMessage":"requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask","statusTrace":"owner_client = <tests.core.client.APIClient object at 0x7f0b048a7d10>\nmain_space = '6866309d85fb8d104544a61e'\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f0b046beac0>\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка счетчика сабтасок в taskTable в родительской задаче\")\n    def test_parent_task_total_subtask_count_increases_after_subtask_creation(owner_client, main_space,create_task_in_main):\n        \"\"\"\n        Тест проверяет увеличение счетчика total сабтасок у родительской задачи после добавления сабтасок.\n        \"\"\"\n        client = owner_client\n        # Создадим родительскую задачу без сабтасок\n        parent_task = create_task_in_main(\"owner_client\", name=\"Parent task for total subtask count test\")\n        parent_task_id = parent_task[\"_id\"]\n        created_subtask_ids = []\n    \n        try:\n            with allure.step(\"Получаем начальное значение total у родительской задачи\"):\n                initial_total = get_parent_task_subtask_count(client, main_space, parent_task_id)\n                assert initial_total == 0\n    \n            with allure.step(\"Создаем первую сабтаску с указанием родительской задачи\"):\n                subtask1 = create_task_in_main(\n                    \"owner_client\",\n                    parent_task=parent_task_id,\n                    name=\"Subtask 1 for parent task total count test\",\n                )\n                created_subtask_ids.append(subtask1[\"_id\"])\n    \n            with allure.step(\"Проверяем, что total увеличился на 1\"):\n                total_after_first = get_parent_task_subtask_count(client, main_space, parent_task_id)\n                assert total_after_first == initial_total + 1, f\"Ожидался total={initial_total + 1}, получили {total_after_first}\"\n    \n            with allure.step(\"Создаем последовательно рандомное количество сабтасок (от 1 до 10) и проверяем total\"):\n                random_count = random.randint(1, 10)\n                for i in range(1, random_count + 1):\n>                   subtask = create_task_in_main(\n                        \"owner_client\",\n                        parent_task=parent_task_id,\n                        name=f\"Random subtask #{i} for parent task total count test\",\n                    )\n\ntests/test_backend/task_service/create_task/test_taskTable_total_subtask_counter.py:51: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/test_backend/task_service/conftest.py:63: in _create_task\n    response.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400]>\n\n    def raise_for_status(self):\n        \"\"\"Raises :class:`HTTPError`, if one occurred.\"\"\"\n    \n        http_error_msg = \"\"\n        if isinstance(self.reason, bytes):\n            # We attempt to decode utf-8 first because some servers\n            # choose to localize their reason strings. If the string\n            # isn't utf-8, we fall back to iso-8859-1 for all other\n            # encodings. (See PR #3538)\n            try:\n                reason = self.reason.decode(\"utf-8\")\n            except UnicodeDecodeError:\n                reason = self.reason.decode(\"iso-8859-1\")\n        else:\n            reason = self.reason\n    \n        if 400 <= self.status_code < 500:\n            http_error_msg = (\n                f\"{self.status_code} Client Error: {reason} for url: {self.url}\"\n            )\n    \n        elif 500 <= self.status_code < 600:\n            http_error_msg = (\n                f\"{self.status_code} Server Error: {reason} for url: {self.url}\"\n            )\n    \n        if http_error_msg:\n>           raise HTTPError(http_error_msg, response=self)\nE           requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask\n\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/requests/models.py:1024: HTTPError","steps":[{"name":"Получаем начальное значение total у родительской задачи","time":{"start":1765881306767,"stop":1765881307638,"duration":871},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Создаем первую сабтаску с указанием родительской задачи","time":{"start":1765881307638,"stop":1765881311672,"duration":4034},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Проверяем, что total увеличился на 1","time":{"start":1765881311672,"stop":1765881312066,"duration":394},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Создаем последовательно рандомное количество сабтасок (от 1 до 10) и проверяем total","time":{"start":1765881312066,"stop":1765881314808,"duration":2742},"status":"broken","statusMessage":"requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/create_task/test_taskTable_total_subtask_counter.py\", line 51, in test_parent_task_total_subtask_count_increases_after_subtask_creation\n    subtask = create_task_in_main(\n              ^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/conftest.py\", line 63, in _create_task\n    response.raise_for_status()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Удаляем все созданные сабтаски и родительскую задачу","time":{"start":1765881314809,"stop":1765881315906,"duration":1097},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":5,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"create_task"},{"name":"tag","value":"backend"},{"name":"suite","value":"test_taskTable_total_subtask_counter"},{"name":"host","value":"runnervm6qbrg"},{"name":"thread","value":"2627-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.task_service.create_task.test_taskTable_total_subtask_counter"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":8,"skipped":0,"passed":98,"unknown":0,"total":106},"items":[{"uid":"d5cf019a399de24b","reportUrl":"https://vaizcom.github.io/autotests/509/#testresult/d5cf019a399de24b","status":"passed","time":{"start":1765880840859,"stop":1765880858954,"duration":18095}},{"uid":"698621a6bc24ccf8","reportUrl":"https://vaizcom.github.io/autotests/508/#testresult/698621a6bc24ccf8","status":"passed","time":{"start":1765874689036,"stop":1765874710024,"duration":20988}},{"uid":"213b8a93b2b1e704","reportUrl":"https://vaizcom.github.io/autotests/507/#testresult/213b8a93b2b1e704","status":"passed","time":{"start":1765809829184,"stop":1765809837049,"duration":7865}},{"uid":"4f00a143dc0ab1ee","reportUrl":"https://vaizcom.github.io/autotests/506/#testresult/4f00a143dc0ab1ee","status":"passed","time":{"start":1765789268803,"stop":1765789281009,"duration":12206}},{"uid":"ce941751ba8e4c0d","reportUrl":"https://vaizcom.github.io/autotests/505/#testresult/ce941751ba8e4c0d","status":"passed","time":{"start":1765786213103,"stop":1765786234408,"duration":21305}},{"uid":"16e21f6b1edec6","reportUrl":"https://vaizcom.github.io/autotests/504/#testresult/16e21f6b1edec6","status":"passed","time":{"start":1765552771910,"stop":1765552784591,"duration":12681}},{"uid":"d3007b1d2847b43c","reportUrl":"https://vaizcom.github.io/autotests/503/#testresult/d3007b1d2847b43c","status":"passed","time":{"start":1765551460905,"stop":1765551471918,"duration":11013}},{"uid":"b3dd202f97632ab2","reportUrl":"https://vaizcom.github.io/autotests/502/#testresult/b3dd202f97632ab2","status":"passed","time":{"start":1765550114045,"stop":1765550125294,"duration":11249}},{"uid":"d9890f888354aeec","reportUrl":"https://vaizcom.github.io/autotests/501/#testresult/d9890f888354aeec","status":"passed","time":{"start":1765544195347,"stop":1765544204941,"duration":9594}},{"uid":"d3a3a00a1e87c81","reportUrl":"https://vaizcom.github.io/autotests/500/#testresult/d3a3a00a1e87c81","status":"passed","time":{"start":1765526042928,"stop":1765526052878,"duration":9950}},{"uid":"b2c6c52aa30b4e87","reportUrl":"https://vaizcom.github.io/autotests/499/#testresult/b2c6c52aa30b4e87","status":"passed","time":{"start":1765457809028,"stop":1765457818407,"duration":9379}},{"uid":"fc32a6a106fc91ae","reportUrl":"https://vaizcom.github.io/autotests/498/#testresult/fc32a6a106fc91ae","status":"passed","time":{"start":1765444036623,"stop":1765444056436,"duration":19813}},{"uid":"3ca31176ac322b74","reportUrl":"https://vaizcom.github.io/autotests/497/#testresult/3ca31176ac322b74","status":"passed","time":{"start":1765442123248,"stop":1765442137547,"duration":14299}},{"uid":"b6bb3bc150049701","reportUrl":"https://vaizcom.github.io/autotests/496/#testresult/b6bb3bc150049701","status":"passed","time":{"start":1765372591611,"stop":1765372602878,"duration":11267}},{"uid":"a8ff9e945ff0dbea","reportUrl":"https://vaizcom.github.io/autotests/495/#testresult/a8ff9e945ff0dbea","status":"passed","time":{"start":1765274027907,"stop":1765274048424,"duration":20517}},{"uid":"44686d975f4f432a","reportUrl":"https://vaizcom.github.io/autotests/494/#testresult/44686d975f4f432a","status":"passed","time":{"start":1765206348094,"stop":1765206362080,"duration":13986}},{"uid":"9a8daba6ecc20dda","reportUrl":"https://vaizcom.github.io/autotests/493/#testresult/9a8daba6ecc20dda","status":"passed","time":{"start":1765203229048,"stop":1765203239644,"duration":10596}},{"uid":"5720da10af2daf66","reportUrl":"https://vaizcom.github.io/autotests/492/#testresult/5720da10af2daf66","status":"passed","time":{"start":1765200346503,"stop":1765200360434,"duration":13931}},{"uid":"4120a221943b4ef7","reportUrl":"https://vaizcom.github.io/autotests/491/#testresult/4120a221943b4ef7","status":"passed","time":{"start":1765188945965,"stop":1765188952831,"duration":6866}},{"uid":"dca09cc7d9c504fa","reportUrl":"https://vaizcom.github.io/autotests/490/#testresult/dca09cc7d9c504fa","status":"passed","time":{"start":1765187629828,"stop":1765187641835,"duration":12007}}]},"tags":["backend"]},"source":"97720426a77858fe.json","parameterValues":[]}