{"uid":"a67b1c536e3971c0","name":"Получение соседей Space-документа для роли manager","fullName":"tests.test_backend.document.access_doc.test_get_siblings_doc_access#test_get_space_doc_siblings_access_by_roles","historyId":"613cf59724c363b4ea4cae3bcea1f907","time":{"start":1752499347161,"stop":1752499350045,"duration":2884},"status":"failed","statusMessage":"AssertionError: assert 400 == 200\n +  where 400 = <Response [400]>.status_code","statusTrace":"request = <FixtureRequest for <Function test_get_space_doc_siblings_access_by_roles[manager]>>\nmain_space = '6866309d85fb8d104544a61e', client_fixture = 'manager_client'\nexpected_status = 200\n\n    @pytest.mark.parametrize(\n        'client_fixture, expected_status',\n        [\n            ('owner_client', 200),\n            ('manager_client', 200),\n            ('member_client', 200),\n            ('guest_client', 403),\n        ],\n        ids=['owner', 'manager', 'member', 'guest'],\n    )\n    def test_get_space_doc_siblings_access_by_roles(request, main_space, client_fixture, expected_status):\n        api_client = request.getfixturevalue(client_fixture)\n        role = client_fixture.replace('_client', '')\n        current_date = datetime.now().strftime('%d.%m_%H:%M:%S')\n    \n        allure.dynamic.title(f'Получение соседей Space-документа для роли {role}')\n    \n        doc_ids = []\n        with allure.step(f'{role} создаёт три Space-документа для проверки соседей'):\n            for index in range(3):\n                title = f'{current_date}_{role}_Sibling Test Doc {index}'\n                create_resp = api_client.post(\n                    **create_document_endpoint(kind='Space', kind_id=main_space, space_id=main_space, title=title)\n                )\n                if create_resp.status_code != 200:\n                    with allure.step(f'Не удалось создать документ {index}, статус {create_resp.status_code}'):\n                        assert expected_status == 403\n                    return\n                doc_id = create_resp.json()['payload']['document']['_id']\n                doc_ids.append(doc_id)\n    \n        middle_doc_id = doc_ids[1]\n    \n        with allure.step(f'{role} пытается получить соседей для среднего документа'):\n            siblings_resp = api_client.post(\n                **get_document_siblings_endpoint(document_id=middle_doc_id, space_id=main_space)\n            )\n            assert siblings_resp.status_code == expected_status\n    \n            if siblings_resp.status_code == 200:\n                payload = siblings_resp.json().get('payload', {})\n                with allure.step('Проверка наличия левого и правого соседа'):\n                    assert 'prevSibling' in payload, 'Нет prevSibling в ответе'\n                    assert 'nextSibling' in payload, 'Нет nextSibling в ответе'\n                    assert payload['prevSibling']['_id'] == doc_ids[0], 'Некорректный левый сосед'\n                    assert payload['nextSibling']['_id'] == doc_ids[2], 'Некорректный правый сосед'\n    \n        with allure.step('Архивация созданных документов'):\n            for doc_id in doc_ids:\n                archive_resp = api_client.post(**archive_document_endpoint(space_id=main_space, document_id=doc_id))\n>               assert archive_resp.status_code == 200\nE               assert 400 == 200\nE                +  where 400 = <Response [400]>.status_code\n\ntests/test_backend/document/access_doc/test_get_siblings_doc_access.py:66: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"base_url","time":{"start":1752499197583,"stop":1752499197583,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"delete_output_dir","time":{"start":1752499197583,"stop":1752499197583,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"_verify_url","time":{"start":1752499197583,"stop":1752499197583,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"pytestconfig","time":{"start":1752499197583,"stop":1752499197583,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"main_client","time":{"start":1752499197584,"stop":1752499198460,"duration":876},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"main_space","time":{"start":1752499198461,"stop":1752499199843,"duration":1382},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"manager_client","time":{"start":1752499208358,"stop":1752499208933,"duration":575},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert 400 == 200\n +  where 400 = <Response [400]>.status_code","statusTrace":"request = <FixtureRequest for <Function test_get_space_doc_siblings_access_by_roles[manager]>>\nmain_space = '6866309d85fb8d104544a61e', client_fixture = 'manager_client'\nexpected_status = 200\n\n    @pytest.mark.parametrize(\n        'client_fixture, expected_status',\n        [\n            ('owner_client', 200),\n            ('manager_client', 200),\n            ('member_client', 200),\n            ('guest_client', 403),\n        ],\n        ids=['owner', 'manager', 'member', 'guest'],\n    )\n    def test_get_space_doc_siblings_access_by_roles(request, main_space, client_fixture, expected_status):\n        api_client = request.getfixturevalue(client_fixture)\n        role = client_fixture.replace('_client', '')\n        current_date = datetime.now().strftime('%d.%m_%H:%M:%S')\n    \n        allure.dynamic.title(f'Получение соседей Space-документа для роли {role}')\n    \n        doc_ids = []\n        with allure.step(f'{role} создаёт три Space-документа для проверки соседей'):\n            for index in range(3):\n                title = f'{current_date}_{role}_Sibling Test Doc {index}'\n                create_resp = api_client.post(\n                    **create_document_endpoint(kind='Space', kind_id=main_space, space_id=main_space, title=title)\n                )\n                if create_resp.status_code != 200:\n                    with allure.step(f'Не удалось создать документ {index}, статус {create_resp.status_code}'):\n                        assert expected_status == 403\n                    return\n                doc_id = create_resp.json()['payload']['document']['_id']\n                doc_ids.append(doc_id)\n    \n        middle_doc_id = doc_ids[1]\n    \n        with allure.step(f'{role} пытается получить соседей для среднего документа'):\n            siblings_resp = api_client.post(\n                **get_document_siblings_endpoint(document_id=middle_doc_id, space_id=main_space)\n            )\n            assert siblings_resp.status_code == expected_status\n    \n            if siblings_resp.status_code == 200:\n                payload = siblings_resp.json().get('payload', {})\n                with allure.step('Проверка наличия левого и правого соседа'):\n                    assert 'prevSibling' in payload, 'Нет prevSibling в ответе'\n                    assert 'nextSibling' in payload, 'Нет nextSibling в ответе'\n                    assert payload['prevSibling']['_id'] == doc_ids[0], 'Некорректный левый сосед'\n                    assert payload['nextSibling']['_id'] == doc_ids[2], 'Некорректный правый сосед'\n    \n        with allure.step('Архивация созданных документов'):\n            for doc_id in doc_ids:\n                archive_resp = api_client.post(**archive_document_endpoint(space_id=main_space, document_id=doc_id))\n>               assert archive_resp.status_code == 200\nE               assert 400 == 200\nE                +  where 400 = <Response [400]>.status_code\n\ntests/test_backend/document/access_doc/test_get_siblings_doc_access.py:66: AssertionError","steps":[{"name":"manager создаёт три Space-документа для проверки соседей","time":{"start":1752499347161,"stop":1752499348596,"duration":1435},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"manager пытается получить соседей для среднего документа","time":{"start":1752499348596,"stop":1752499349202,"duration":606},"status":"passed","steps":[{"name":"Проверка наличия левого и правого соседа","time":{"start":1752499349202,"stop":1752499349202,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true},{"name":"Архивация созданных документов","time":{"start":1752499349202,"stop":1752499350044,"duration":842},"status":"failed","statusMessage":"AssertionError: assert 400 == 200\n +  where 400 = <Response [400]>.status_code\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/document/access_doc/test_get_siblings_doc_access.py\", line 66, in test_get_space_doc_siblings_access_by_roles\n    assert archive_resp.status_code == 200\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":4,"attachmentsCount":0,"hasContent":true},"afterStages":[],"labels":[{"name":"tag","value":"backend"},{"name":"parentSuite","value":"tests.test_backend.document.access_doc"},{"name":"suite","value":"test_get_siblings_doc_access"},{"name":"host","value":"pkrvmq0rgcvqdmg"},{"name":"thread","value":"2610-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.document.access_doc.test_get_siblings_doc_access"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"client_fixture","value":"'manager_client'"},{"name":"expected_status","value":"200"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":3,"broken":0,"skipped":0,"passed":39,"unknown":0,"total":42},"items":[{"uid":"5b28ae3a77a5c6fa","reportUrl":"https://vaizcom.github.io/autotests/293//#testresult/5b28ae3a77a5c6fa","status":"passed","time":{"start":1752498285142,"stop":1752498286921,"duration":1779}},{"uid":"60070defeb605e1f","reportUrl":"https://vaizcom.github.io/autotests/292//#testresult/60070defeb605e1f","status":"passed","time":{"start":1752496634243,"stop":1752496636424,"duration":2181}},{"uid":"21dd3d55350f055f","reportUrl":"https://vaizcom.github.io/autotests/291//#testresult/21dd3d55350f055f","status":"passed","time":{"start":1752481736695,"stop":1752481738490,"duration":1795}},{"uid":"30c87ac73048d835","reportUrl":"https://vaizcom.github.io/autotests/290//#testresult/30c87ac73048d835","status":"passed","time":{"start":1752479780144,"stop":1752479782670,"duration":2526}},{"uid":"a9256efbc87cabe","reportUrl":"https://vaizcom.github.io/autotests/289//#testresult/a9256efbc87cabe","status":"passed","time":{"start":1752477930154,"stop":1752477931928,"duration":1774}},{"uid":"1e3c3cf9316713d8","reportUrl":"https://vaizcom.github.io/autotests/288//#testresult/1e3c3cf9316713d8","status":"passed","time":{"start":1752236796278,"stop":1752236798320,"duration":2042}},{"uid":"8307129a265cd46e","reportUrl":"https://vaizcom.github.io/autotests/287//#testresult/8307129a265cd46e","status":"passed","time":{"start":1752236164605,"stop":1752236166644,"duration":2039}},{"uid":"a46bc6be52dfc03f","reportUrl":"https://vaizcom.github.io/autotests/286//#testresult/a46bc6be52dfc03f","status":"passed","time":{"start":1752235414393,"stop":1752235416781,"duration":2388}},{"uid":"ef90bd2385c8aed1","reportUrl":"https://vaizcom.github.io/autotests/285//#testresult/ef90bd2385c8aed1","status":"failed","statusDetails":"AssertionError: Некорректный правый сосед\nassert '6870fd734aff74363a1c8bf1' == '6870fd734aff74363a1c8bf8'\n  \n  - 6870fd734aff74363a1c8bf8\n  ?                        ^\n  + 6870fd734aff74363a1c8bf1\n  ?                        ^","time":{"start":1752235379128,"stop":1752235381216,"duration":2088}},{"uid":"94dc3bb0d51ca667","reportUrl":"https://vaizcom.github.io/autotests/283//#testresult/94dc3bb0d51ca667","status":"passed","time":{"start":1752234432601,"stop":1752234436481,"duration":3880}},{"uid":"93440f88ca866ae8","reportUrl":"https://vaizcom.github.io/autotests/284//#testresult/93440f88ca866ae8","status":"passed","time":{"start":1752234400786,"stop":1752234403040,"duration":2254}},{"uid":"b20356f5558bd0cc","reportUrl":"https://vaizcom.github.io/autotests/281//#testresult/b20356f5558bd0cc","status":"failed","statusDetails":"AssertionError: Некорректный левый сосед\nassert '6870f6714aff74363a1b4175' == '6870f6714aff74363a1b416d'\n  \n  - 6870f6714aff74363a1b416d\n  ?                       ^^\n  + 6870f6714aff74363a1b4175\n  ?                       ^^","time":{"start":1752233585286,"stop":1752233587286,"duration":2000}},{"uid":"8b01ec1b1b0d9e2f","reportUrl":"https://vaizcom.github.io/autotests/280//#testresult/8b01ec1b1b0d9e2f","status":"passed","time":{"start":1752232646150,"stop":1752232648082,"duration":1932}},{"uid":"6c61f6c8facf2247","reportUrl":"https://vaizcom.github.io/autotests/279//#testresult/6c61f6c8facf2247","status":"passed","time":{"start":1752232184193,"stop":1752232186244,"duration":2051}},{"uid":"9cbf6ba5dd7bfeaf","reportUrl":"https://vaizcom.github.io/autotests/278//#testresult/9cbf6ba5dd7bfeaf","status":"passed","time":{"start":1752223579213,"stop":1752223580944,"duration":1731}},{"uid":"91154f138ddb346","reportUrl":"https://vaizcom.github.io/autotests/277//#testresult/91154f138ddb346","status":"passed","time":{"start":1752218318444,"stop":1752218320231,"duration":1787}},{"uid":"b67e12c6ee12ba4c","reportUrl":"https://vaizcom.github.io/autotests/276//#testresult/b67e12c6ee12ba4c","status":"passed","time":{"start":1752151085521,"stop":1752151087649,"duration":2128}},{"uid":"44f824c41a6a6556","reportUrl":"https://vaizcom.github.io/autotests/275//#testresult/44f824c41a6a6556","status":"passed","time":{"start":1752148935632,"stop":1752148937275,"duration":1643}},{"uid":"c783c43b192f3133","reportUrl":"https://vaizcom.github.io/autotests/274//#testresult/c783c43b192f3133","status":"passed","time":{"start":1752138410918,"stop":1752138413327,"duration":2409}},{"uid":"f95b088852a4c7c9","reportUrl":"https://vaizcom.github.io/autotests/273//#testresult/f95b088852a4c7c9","status":"passed","time":{"start":1752137285650,"stop":1752137287497,"duration":1847}}]},"tags":["backend"]},"source":"a67b1c536e3971c0.json","parameterValues":["'manager_client'","200"]}