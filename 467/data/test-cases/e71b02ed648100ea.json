{"uid":"e71b02ed648100ea","name":"Проверка index -> ожидаемая позиция задачи в колонке| Пустая группа, индекс=0 ","fullName":"tests.test_backend.task_service.create_task.test_task_indexing_in_group#test_task_indexing_in_group","historyId":"7d0de86e2da575e379d6dd33a5333e61","time":{"start":1763732940013,"stop":1763732942444,"duration":2431},"description":"\n    Тест проверяет корректность позиционирования задач при создании новой задачи в группе на доске (board).\n    ","descriptionHtml":"<pre><code>Тест проверяет корректность позиционирования задач при создании новой задачи в группе на доске (board).\n</code></pre>\n","status":"broken","statusMessage":"requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask","statusTrace":"request = <FixtureRequest for <Function test_task_indexing_in_group[empty_group_index_0]>>\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f052aa75940>\nmain_space = '6866309d85fb8d104544a61e', main_board = '6866731185fb8d104544e826'\ninitial_tasks = 0, create_index = 0, expected_position = 0\ntitle = 'Пустая группа, индекс=0'\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка что index соответствует ожидаемой позиции задачи в колонке\")\n    @pytest.mark.parametrize(\n        \"initial_tasks, create_index, expected_position, title\",\n        [\n            (0, None, 0, \"Пустая группа, индекс не указан\"),\n            (0, 0, 0, \"Пустая группа, индекс=0\"),\n            (0, 10, 0, \"Пустая группа, индекс=10\"),\n            (10, 2, 2, \"Группа из 10 тасок, индекс=2\"),\n            (10, 999, 10, \"Группа из 10 тасок, индекс=999\"),\n            (10, 0, 0, \"Группа из 10 тасок, индекс=0\"),\n            (10, 10,10, \"Группа из 10 тасок, индекс=10\"),\n            (10,9,9, \"Группа из 10 тасок, индекс=9\"),\n            (10, None, 10, \"Группа из 10 тасок, индекс не указан\")\n        ],\n        ids=[\n            \"empty_group_no_index\",\n            \"empty_group_index_0\",\n            \"empty_group_index_10\",\n            \"ten_tasks_index_2\",\n            \"ten_tasks_index_999\",\n            \"ten_tasks_index_0\",\n            \"ten_tasks_index_10\",\n            \"ten_tasks_index_9\",\n            \"ten_tasks_index_none\"\n        ]\n    )\n    def test_task_indexing_in_group(\n        request, create_task_in_main, main_space, main_board, initial_tasks, create_index, expected_position, title,\n    ):\n        \"\"\"\n        Тест проверяет корректность позиционирования задач при создании новой задачи в группе на доске (board).\n        \"\"\"\n        allure.dynamic.title(f\"Проверка index -> ожидаемая позиция задачи в колонке| {title} \")\n    \n        with allure.step(\"Получить ID первой группы на доске\"):\n            client = request.getfixturevalue(\"owner_client\")\n            resp = client.post(**get_board_endpoint(main_board, main_space))\n            group_id = resp.json()[\"payload\"][\"board\"][\"groups\"][0][\"_id\"]\n    \n        with allure.step(\"Очистить все задачи в выбранной группе\"):\n            delete_all_group_tasks(client, main_board, main_space, group_id)\n    \n        try:\n            with allure.step(\"Убедиться, что группа действительно пуста\"):\n                for try_num in range(5):\n                    board = client.post(**get_board_endpoint(main_board, main_space)).json()[\"payload\"][\"board\"]\n                    task_ids = board[\"taskOrderByGroups\"].get(group_id, [])\n                    if not task_ids:\n                        break\n                    time.sleep(1)\n                assert not task_ids, f\"Группа не пуста после очистки! Остались: {task_ids}\"\n    \n            with allure.step(\"Добавить стартовые задачи в группу для сценариев где initial_tasks != 0 (Только если требуется по сценарию)\"):\n                for i in range(initial_tasks):\n                    create_task_in_main(\n                        client_fixture=\"owner_client\",\n                        group=group_id,\n                        index=i,\n                        name=f\"Initial Task #{i}\"\n                    )\n    \n            with allure.step(f\"Создать новую тестовую задачу: {title}\"):\n                params = {\n                    \"client_fixture\": \"owner_client\",\n                    \"group\": group_id,\n                    \"name\": \"Target Task!!!!\",\n                    \"index\": create_index,\n                }\n>               target_task = create_task_in_main(**params)\n\ntests/test_backend/task_service/create_task/test_task_indexing_in_group.py:79: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/test_backend/task_service/conftest.py:67: in _create_task\n    response.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400]>\n\n    def raise_for_status(self):\n        \"\"\"Raises :class:`HTTPError`, if one occurred.\"\"\"\n    \n        http_error_msg = \"\"\n        if isinstance(self.reason, bytes):\n            # We attempt to decode utf-8 first because some servers\n            # choose to localize their reason strings. If the string\n            # isn't utf-8, we fall back to iso-8859-1 for all other\n            # encodings. (See PR #3538)\n            try:\n                reason = self.reason.decode(\"utf-8\")\n            except UnicodeDecodeError:\n                reason = self.reason.decode(\"iso-8859-1\")\n        else:\n            reason = self.reason\n    \n        if 400 <= self.status_code < 500:\n            http_error_msg = (\n                f\"{self.status_code} Client Error: {reason} for url: {self.url}\"\n            )\n    \n        elif 500 <= self.status_code < 600:\n            http_error_msg = (\n                f\"{self.status_code} Server Error: {reason} for url: {self.url}\"\n            )\n    \n        if http_error_msg:\n>           raise HTTPError(http_error_msg, response=self)\nE           requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask\n\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/requests/models.py:1024: HTTPError","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"base_url","time":{"start":1763732456616,"stop":1763732456616,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"owner_client","time":{"start":1763732456617,"stop":1763732457277,"duration":660},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1763732456617,"stop":1763732456617,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1763732456617,"stop":1763732456617,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1763732456617,"stop":1763732456617,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_client","time":{"start":1763732459027,"stop":1763732459322,"duration":295},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_space","time":{"start":1763732459322,"stop":1763732459609,"duration":287},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_project","time":{"start":1763732459609,"stop":1763732460286,"duration":677},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"main_board","time":{"start":1763732465184,"stop":1763732466251,"duration":1067},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"create_task_in_main","time":{"start":1763732940012,"stop":1763732940012,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Тест проверяет корректность позиционирования задач при создании новой задачи в группе на доске (board).\n    ","status":"broken","statusMessage":"requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask","statusTrace":"request = <FixtureRequest for <Function test_task_indexing_in_group[empty_group_index_0]>>\ncreate_task_in_main = <function create_task_in_main.<locals>._create_task at 0x7f052aa75940>\nmain_space = '6866309d85fb8d104544a61e', main_board = '6866731185fb8d104544e826'\ninitial_tasks = 0, create_index = 0, expected_position = 0\ntitle = 'Пустая группа, индекс=0'\n\n    @allure.parent_suite(\"create_task\")\n    @allure.title(\"Проверка что index соответствует ожидаемой позиции задачи в колонке\")\n    @pytest.mark.parametrize(\n        \"initial_tasks, create_index, expected_position, title\",\n        [\n            (0, None, 0, \"Пустая группа, индекс не указан\"),\n            (0, 0, 0, \"Пустая группа, индекс=0\"),\n            (0, 10, 0, \"Пустая группа, индекс=10\"),\n            (10, 2, 2, \"Группа из 10 тасок, индекс=2\"),\n            (10, 999, 10, \"Группа из 10 тасок, индекс=999\"),\n            (10, 0, 0, \"Группа из 10 тасок, индекс=0\"),\n            (10, 10,10, \"Группа из 10 тасок, индекс=10\"),\n            (10,9,9, \"Группа из 10 тасок, индекс=9\"),\n            (10, None, 10, \"Группа из 10 тасок, индекс не указан\")\n        ],\n        ids=[\n            \"empty_group_no_index\",\n            \"empty_group_index_0\",\n            \"empty_group_index_10\",\n            \"ten_tasks_index_2\",\n            \"ten_tasks_index_999\",\n            \"ten_tasks_index_0\",\n            \"ten_tasks_index_10\",\n            \"ten_tasks_index_9\",\n            \"ten_tasks_index_none\"\n        ]\n    )\n    def test_task_indexing_in_group(\n        request, create_task_in_main, main_space, main_board, initial_tasks, create_index, expected_position, title,\n    ):\n        \"\"\"\n        Тест проверяет корректность позиционирования задач при создании новой задачи в группе на доске (board).\n        \"\"\"\n        allure.dynamic.title(f\"Проверка index -> ожидаемая позиция задачи в колонке| {title} \")\n    \n        with allure.step(\"Получить ID первой группы на доске\"):\n            client = request.getfixturevalue(\"owner_client\")\n            resp = client.post(**get_board_endpoint(main_board, main_space))\n            group_id = resp.json()[\"payload\"][\"board\"][\"groups\"][0][\"_id\"]\n    \n        with allure.step(\"Очистить все задачи в выбранной группе\"):\n            delete_all_group_tasks(client, main_board, main_space, group_id)\n    \n        try:\n            with allure.step(\"Убедиться, что группа действительно пуста\"):\n                for try_num in range(5):\n                    board = client.post(**get_board_endpoint(main_board, main_space)).json()[\"payload\"][\"board\"]\n                    task_ids = board[\"taskOrderByGroups\"].get(group_id, [])\n                    if not task_ids:\n                        break\n                    time.sleep(1)\n                assert not task_ids, f\"Группа не пуста после очистки! Остались: {task_ids}\"\n    \n            with allure.step(\"Добавить стартовые задачи в группу для сценариев где initial_tasks != 0 (Только если требуется по сценарию)\"):\n                for i in range(initial_tasks):\n                    create_task_in_main(\n                        client_fixture=\"owner_client\",\n                        group=group_id,\n                        index=i,\n                        name=f\"Initial Task #{i}\"\n                    )\n    \n            with allure.step(f\"Создать новую тестовую задачу: {title}\"):\n                params = {\n                    \"client_fixture\": \"owner_client\",\n                    \"group\": group_id,\n                    \"name\": \"Target Task!!!!\",\n                    \"index\": create_index,\n                }\n>               target_task = create_task_in_main(**params)\n\ntests/test_backend/task_service/create_task/test_task_indexing_in_group.py:79: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntests/test_backend/task_service/conftest.py:67: in _create_task\n    response.raise_for_status()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <Response [400]>\n\n    def raise_for_status(self):\n        \"\"\"Raises :class:`HTTPError`, if one occurred.\"\"\"\n    \n        http_error_msg = \"\"\n        if isinstance(self.reason, bytes):\n            # We attempt to decode utf-8 first because some servers\n            # choose to localize their reason strings. If the string\n            # isn't utf-8, we fall back to iso-8859-1 for all other\n            # encodings. (See PR #3538)\n            try:\n                reason = self.reason.decode(\"utf-8\")\n            except UnicodeDecodeError:\n                reason = self.reason.decode(\"iso-8859-1\")\n        else:\n            reason = self.reason\n    \n        if 400 <= self.status_code < 500:\n            http_error_msg = (\n                f\"{self.status_code} Client Error: {reason} for url: {self.url}\"\n            )\n    \n        elif 500 <= self.status_code < 600:\n            http_error_msg = (\n                f\"{self.status_code} Server Error: {reason} for url: {self.url}\"\n            )\n    \n        if http_error_msg:\n>           raise HTTPError(http_error_msg, response=self)\nE           requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask\n\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/requests/models.py:1024: HTTPError","steps":[{"name":"Получить ID первой группы на доске","time":{"start":1763732940013,"stop":1763732940353,"duration":340},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Очистить все задачи в выбранной группе","time":{"start":1763732940353,"stop":1763732940626,"duration":273},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Убедиться, что группа действительно пуста","time":{"start":1763732940626,"stop":1763732940898,"duration":272},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Добавить стартовые задачи в группу для сценариев где initial_tasks != 0 (Только если требуется по сценарию)","time":{"start":1763732940898,"stop":1763732940898,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Создать новую тестовую задачу: Пустая группа, индекс=0","time":{"start":1763732940898,"stop":1763732941879,"duration":981},"status":"broken","statusMessage":"requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://vaiz-api-ms.vaiz.dev/v4/CreateTask\n","statusTrace":"  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/create_task/test_task_indexing_in_group.py\", line 79, in test_task_indexing_in_group\n    target_task = create_task_in_main(**params)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/autotests/autotests/tests/test_backend/task_service/conftest.py\", line 67, in _create_task\n    response.raise_for_status()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Финальная очистка группы после завершения теста","time":{"start":1763732941879,"stop":1763732942444,"duration":565},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":6,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"create_task"},{"name":"tag","value":"backend"},{"name":"suite","value":"test_task_indexing_in_group"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"2627-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_backend.task_service.create_task.test_task_indexing_in_group"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"create_index","value":"0"},{"name":"expected_position","value":"0"},{"name":"initial_tasks","value":"0"},{"name":"title","value":"'Пустая группа, индекс=0'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":6,"skipped":0,"passed":56,"unknown":0,"total":63},"items":[{"uid":"cb217bd1279a7731","reportUrl":"https://vaizcom.github.io/autotests/466/#testresult/cb217bd1279a7731","status":"passed","time":{"start":1763726525026,"stop":1763726528016,"duration":2990}},{"uid":"85d160b7c194474a","reportUrl":"https://vaizcom.github.io/autotests/465/#testresult/85d160b7c194474a","status":"passed","time":{"start":1763720039393,"stop":1763720042328,"duration":2935}},{"uid":"b0b9671587d9df1c","reportUrl":"https://vaizcom.github.io/autotests/464/#testresult/b0b9671587d9df1c","status":"passed","time":{"start":1763715342339,"stop":1763715345040,"duration":2701}},{"uid":"26ef5188e356d8de","reportUrl":"https://vaizcom.github.io/autotests/463/#testresult/26ef5188e356d8de","status":"passed","time":{"start":1763714720757,"stop":1763714724132,"duration":3375}},{"uid":"4d72fb6919000cd6","reportUrl":"https://vaizcom.github.io/autotests/462/#testresult/4d72fb6919000cd6","status":"passed","time":{"start":1763711209316,"stop":1763711212027,"duration":2711}},{"uid":"76378185cc29bdfd","reportUrl":"https://vaizcom.github.io/autotests/461/#testresult/76378185cc29bdfd","status":"passed","time":{"start":1763710207994,"stop":1763710211332,"duration":3338}},{"uid":"dcd9706ceaf2aa5","reportUrl":"https://vaizcom.github.io/autotests/460/#testresult/dcd9706ceaf2aa5","status":"failed","statusDetails":"AssertionError: Группа 6866731185fb8d104544e827 осталась не пустой: ['691f304c8b5dc0d953574a00']","time":{"start":1763651646865,"stop":1763651678217,"duration":31352}},{"uid":"edc708dd63e72127","reportUrl":"https://vaizcom.github.io/autotests/459/#testresult/edc708dd63e72127","status":"passed","time":{"start":1763649877585,"stop":1763649880666,"duration":3081}},{"uid":"ae6466743c24b683","reportUrl":"https://vaizcom.github.io/autotests/458/#testresult/ae6466743c24b683","status":"passed","time":{"start":1763631276382,"stop":1763631279135,"duration":2753}},{"uid":"5a6c3200d35ed8bf","reportUrl":"https://vaizcom.github.io/autotests/457/#testresult/5a6c3200d35ed8bf","status":"passed","time":{"start":1763628635378,"stop":1763628637948,"duration":2570}},{"uid":"3e9cf3cf3be762be","reportUrl":"https://vaizcom.github.io/autotests/456/#testresult/3e9cf3cf3be762be","status":"passed","time":{"start":1763559718077,"stop":1763559721574,"duration":3497}},{"uid":"c0a3afedb931693","reportUrl":"https://vaizcom.github.io/autotests/455/#testresult/c0a3afedb931693","status":"passed","time":{"start":1763542677831,"stop":1763542681444,"duration":3613}},{"uid":"f9444733df2efaf2","reportUrl":"https://vaizcom.github.io/autotests/454/#testresult/f9444733df2efaf2","status":"passed","time":{"start":1763540423861,"stop":1763540426645,"duration":2784}},{"uid":"418a8e73723b8198","reportUrl":"https://vaizcom.github.io/autotests/453/#testresult/418a8e73723b8198","status":"passed","time":{"start":1763477865238,"stop":1763477868290,"duration":3052}},{"uid":"6e7e38f0a45e2ae9","reportUrl":"https://vaizcom.github.io/autotests/452/#testresult/6e7e38f0a45e2ae9","status":"passed","time":{"start":1763476060095,"stop":1763476062958,"duration":2863}},{"uid":"e4f5b45d54a69ca0","reportUrl":"https://vaizcom.github.io/autotests/451/#testresult/e4f5b45d54a69ca0","status":"passed","time":{"start":1763406045718,"stop":1763406048862,"duration":3144}},{"uid":"e8dd60f9cc65e1c3","reportUrl":"https://vaizcom.github.io/autotests/450/#testresult/e8dd60f9cc65e1c3","status":"passed","time":{"start":1763391716846,"stop":1763391720079,"duration":3233}},{"uid":"2a7501dc26c2910f","reportUrl":"https://vaizcom.github.io/autotests/449/#testresult/2a7501dc26c2910f","status":"passed","time":{"start":1763389912269,"stop":1763389915285,"duration":3016}},{"uid":"2fb54b338e72c616","reportUrl":"https://vaizcom.github.io/autotests/449/#testresult/2fb54b338e72c616","status":"passed","time":{"start":1763388883970,"stop":1763388887023,"duration":3053}},{"uid":"32fead5fadb6b80c","reportUrl":"https://vaizcom.github.io/autotests/449/#testresult/32fead5fadb6b80c","status":"broken","statusDetails":"requests.exceptions.JSONDecodeError: Expecting value: line 1 column 1 (char 0)","time":{"start":1763387987504,"stop":1763387987633,"duration":129}}]},"tags":["backend"]},"source":"e71b02ed648100ea.json","parameterValues":["0","0","0","'Пустая группа, индекс=0'"]}